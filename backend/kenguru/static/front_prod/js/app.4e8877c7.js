(function(){"use strict";var t={1121:function(t,e,i){var s=i(6369),a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("v-app",{staticClass:"w-100"},[i("v-navigation-drawer",{attrs:{app:"",width:"225"}},[i("app-navbar",{attrs:{user:t.user}})],1),i("v-main",[t.isLoad?t._e():i("app-loader"),i("router-view",{class:{"d-none":!t.isLoad},attrs:{user:t.user},on:{loadComplete:function(e){t.isLoad=!0},showAlert:function(e){return t.showAlert(e)}}}),i("v-snackbar",{attrs:{color:"white"},scopedSlots:t._u([{key:"action",fn:function(e){var s=e.attrs;return[i("v-btn",t._b({attrs:{color:"orange accent-2",tile:""},on:{click:function(e){t.snackbar=!1}}},"v-btn",s,!1),[t._v(" Ок ")])]}}]),model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},[i("span",{staticClass:"text-dark"},[t._v(t._s(t.snackbarText))])])],1)],1)],1)},r=[];let o="http://127.0.0.1:8000";var n={baseUrl:o,urls:{checkUser:`${o}/api1/user_crm/check_user/`,login:`${o}/api1/user_crm/login/`,logout:`${o}/api1/user_crm/logout/`,house:`${o}/api1/house/`,houseCreatePhotoDirFtp:`${o}/api1/house/create_photo_dir_ftp/`,paperSize:`${o}/api1/paper_size/`,liftboardLayout:`${o}/api1/liftboard_layout/`,placemarker:`${o}/api1/placemarker/`,client:`${o}/api1/client/`,clientAutocomplite:`${o}/api1/client/autocomplite/`,advertisingAndDetail:`${o}/api1/advertising_and_detail/`,advertisingProgram:`${o}/api1/advertising_program/`,advertisingProgramStatistic:`${o}/api1/advertising_program_statistic/`,advertisingProgramEdit:`${o}/api1/advertising_program_edit/`,advertisingProgramProlong:`${o}/api1/advertising_program_prolong/`,advertisingProgramMerge:`${o}/api1/advertising_program_merge/`,advertisingProgramMergeGetFirst:`${o}/api1/advertising_program_merge_get_first/`,advertisingProgramMergeGetSecond:`${o}/api1/advertising_program_merge_get_second/`,advertisingProgramMergeGetHouseList:`${o}/api1/advertising_program_merge_get_house_list/`,advertisingProgramChangeComplete:`${o}/api1/advertising_program_change_complete/`,period:`${o}/api1/period/`,freeSpaceElevator:`${o}/api1/free_space_elevator/`,reportFreeElevators:`${o}/api1/report/free_elevator/`,renderReportFreeArea:`${o}/api1/report/render_report_free_area/`,renderAdhesiveSheet:`${o}/api1/report/render_adhesive_sheet/`},clientTypeList:[{id:1,label:"Рекламодатель"},{id:2,label:"ТСЖ/УК"},{id:3,label:"Партнер"},{id:4,label:"Кенгуру"}],statusAdvertisingProgramList:[{id:1,label:"Новая"},{id:2,label:"Продление без смены макета"},{id:3,label:"Продление и смена макета"}],yesNoList:[{id:!0,label:"Да"},{id:!1,label:"Нет"}],yesNoNullList:[{id:"",label:"-"},{id:!0,label:"Да"},{id:!1,label:"Нет"}]},l={getCookie(t){const e=`; ${document.cookie}`,i=e.split(`; ${t}=`);if(2===i.length)return i.pop().split(";").shift()},setCookie(t,e,i={}){i={path:"/",...i},i.expires instanceof Date&&(i.expires=i.expires.toUTCString());let s=encodeURIComponent(t)+"="+encodeURIComponent(e);for(let a in i){s+="; "+a;let t=i[a];!0!==t&&(s+="="+t)}document.cookie=s}},c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-card",{staticClass:"d-flex flex-column flex-shrink-0  text-white border-radius-0",attrs:{dark:""}},[s("div",{staticClass:"logo-place"},[s("v-list-item",{staticClass:"px-2"},[s("v-list-item-avatar",{staticClass:"me-2"},[s("img",{attrs:{src:i(1637)}})]),s("v-list-item-title",[s("b",[t._v("КЕНГУРУ CRM")])])],1)],1),s("v-list",{staticClass:"nav-place w-100 ",attrs:{dense:""}},[s("v-list-item-group",t._l(t.items,(function(e){return s("router-link",{key:e.name,staticClass:"nav-links",attrs:{to:e.name}},[!1===e.onlyAdmin||t.user.isAdmin?s("v-list-item",[s("v-list-item-icon",{staticClass:"me-3"},[s("v-icon",[t._v(t._s(e.icon))])],1),s("v-list-item-content",[s("v-list-item-title",[t._v(" "+t._s(e.title)+" ")])],1)],1):t._e()],1)})),1)],1),s("div",{staticClass:"user-place mt-auto w-100"},[s("v-list",{attrs:{dense:""}},[t.user.userName?[s("v-list-item",{attrs:{link:""},on:{click:t.logout}},[s("v-list-item-icon",{staticClass:"me-3 "},[s("v-avatar",{attrs:{color:"#fff",size:"28"}},[s("v-icon",{attrs:{color:"orange"}},[t._v("mdi-account-multiple-outline")])],1)],1),s("v-list-item-content",{staticClass:"mt-1"},[s("v-list-item-title",[t._v(" Выйти ("+t._s(t.user.userName)+")")])],1)],1)]:s("router-link",{staticClass:"nav-links",attrs:{to:"login"}},[s("v-list-item",{attrs:{link:""}},[s("v-list-item-icon",{staticClass:"me-3 "},[s("v-avatar",{attrs:{color:"#fff",size:"28"}},[s("v-icon",{attrs:{color:"orange"}},[t._v("mdi-account-multiple-outline")])],1)],1),s("v-list-item-content",{staticClass:"mt-1"},[s("v-list-item-title",[t._v(" Войти")])],1)],1)],1)],2)],1),s("div",{staticClass:"glad-place"},[s("div",{staticClass:"text-white px-3 mt-3 small"},[s("b",[t._v("Разработка "),s("a",{staticClass:"text-danger text-decoration-none d-inline",attrs:{href:"https://kirillgladkikh.ru/"}},[t._v("Гладких К.А.")])])])])],1)},d=[],v={name:"AppNavbar",props:["user"],methods:{logout(){l.setCookie("sessionid","",{"max-age":-1}),location.reload()}},data(){return{items:[{title:"Рекламные программы",icon:"mdi-clipboard-list",name:"advertising_program",onlyAdmin:!0},{title:"Клиенты",icon:"mdi-account-group-outline",name:"client",onlyAdmin:!0},{title:"Дома и лифты",icon:"mdi-home-city",name:"house",onlyAdmin:!0},{title:"Свободные площадки",icon:"mdi-home-analytics",name:"freeElevatorsView",onlyAdmin:!1}]}}},u=v,h=i(3736),m=(0,h.Z)(u,c,d,!1,null,"6c06b9e9",null),g=m.exports,p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-card",{staticClass:"w-100 d-flex justify-content-center loader border-radius-0",attrs:{dark:""}},[s("div",{staticClass:"align-self-center text-center"},[s("img",{staticClass:"fadeIn",attrs:{width:"125",src:i(1637),alt:""}}),s("p",{staticClass:"text-white h3 mt-3"},[s("b",[t._v("Загрузка...")])]),s("p",{staticClass:"text-white h3 mt-4 small"},[s("b",[t._v("обычно не дольше 10 секунд =}")])]),s("p",{staticClass:"text-white h3 mt-1 small"},[s("b",[t._v("если дольше, то обновите страничку=}")])]),s("p",{staticClass:"text-white h3 mt-1 small"},[s("b",[t._v("если не помогло, то звоните 8-924-375-05-73 =}")])])])])},f=[],b={name:"AppLoader"},C=b,_=(0,h.Z)(C,p,f,!1,null,"9715423a",null),x=_.exports,A={created:async function(){await this.checkUser()},components:{AppNavbar:g,AppLoader:x},methods:{showAlert(t){this.snackbar=!0,this.snackbarText=t},async checkUser(){const t=l.getCookie("sessionid");if(void 0===t)return this.isLogin=!1,!1;const e=n.urls.checkUser+`${t}/`,i=await fetch(e,{method:"get"}),s=await i.json();!0===s.isLogin?(this.isLogin=!0,this.user={userName:s["userName"],isAdmin:s["isAdmin"]}):this.isLogin=!1}},data(){return{isLogin:!1,isLoad:!1,user:{isAdmin:!1,userName:null},snackbar:!1,snackbarText:""}},watch:{"$route.path"(){this.isLoad=!1}}},y=A,w=(0,h.Z)(y,a,r,!1,null,null,null),S=w.exports,k=i(2631),L=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"w-100 px-3 pt-2 pb-5  d-flex flex-column "},[i("div",{staticClass:"row "},[i("div",{staticClass:"col-12"},[i("h1",[t._v("Клиенты")]),i("div",{staticClass:"row"},[i("div",{staticClass:"col-3"},[i("v-text-field",{attrs:{label:"Быстрый поиск"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getList.apply(null,arguments)},blur:t.getList},model:{value:t.filterAndSort.search,callback:function(e){t.$set(t.filterAndSort,"search",e)},expression:"filterAndSort.search"}})],1),i("div",{staticClass:"col-3"},[i("v-select",{attrs:{label:"Тип клиента","item-text":"label","item-value":"id",items:t.clientTypeList},model:{value:t.filterAndSort.clientType,callback:function(e){t.$set(t.filterAndSort,"clientType",e)},expression:"filterAndSort.clientType"}})],1),i("div",{staticClass:"col-3"},[i("v-select",{attrs:{label:"В архиве","item-text":"label","item-value":"id",items:t.yesNoList},model:{value:t.filterAndSort.inArchive,callback:function(e){t.$set(t.filterAndSort,"inArchive",e)},expression:"filterAndSort.inArchive"}})],1),i("div",{staticClass:"col-3"},[i("v-select",{attrs:{label:"Сортировка по:","item-text":"label","item-value":"id",items:t.sortList},model:{value:t.filterAndSort.orderBy,callback:function(e){t.$set(t.filterAndSort,"orderBy",e)},expression:"filterAndSort.orderBy"}})],1)]),i("div",{},[i("span",{staticClass:"small"},[t._v("Отображается клиентов: "+t._s(t.clientsList.length)+" из "+t._s(t.clientCount))]),i("a",{staticClass:"small ms-2 d-inline-block text-warning",attrs:{href:"#"},on:{click:t.resetFilterAndSort}},[t._v("(Сбросить фильтры)")])]),i("v-progress-linear",{staticClass:"mt-3",attrs:{indeterminate:"",active:t.ajaxLoad,color:"yellow darken-2"}})],1)]),i("div",{staticClass:" spisok-clientov row"},[t.clientsList.length>0?t._l(t.clientsList,(function(e,s){return i("div",{key:s,staticClass:"col-3"},[i("v-card",{staticClass:"shadow",attrs:{outlined:"",elevation:"7"}},[i("v-list-item",{attrs:{"three-line":""}},[i("v-list-item-content",[i("div",{staticClass:"text-overline mb-3 ",class:{"text-primary":1===e.clientType,"text-info":2===e.clientType,"text-success":3===e.clientType,"text-warning":4===e.clientType}},[t._v(" "+t._s(e.clientTypeDisplay)+" ")]),i("v-list-item-title",{staticClass:"text-h5 mb-1"},[i("b",[t._v(t._s(e.name))])]),e.inn?i("v-list-item-subtitle",[t._v("ИНН: "+t._s(e.inn))]):t._e(),e.fioResponsible?i("v-list-item-subtitle",[t._v("ФИО ответственного: "+t._s(e.fioResponsible)+" ")]):t._e(),e.phoneResponsible?i("v-list-item-subtitle",[t._v("Телефон ответственного: "+t._s(e.phoneResponsible)+" ")]):t._e(),e.emailResponsible?i("v-list-item-subtitle",[t._v("Email ответственного: "+t._s(e.emailResponsible)+" ")]):t._e(),i("hr",{staticClass:"my-2"}),i("v-list-item-subtitle",[t._v("Доход за всё время: "+t._s(e.budgetForAllTime)+" руб. ")]),i("v-list-item-subtitle",[t._v("РП за всё время: "+t._s(e.countAdvertisingProgramForAllTime)+" шт. ")])],1),[i("v-list-item-avatar",{staticClass:"rounded-circle  shadow",class:{"bg-primary bg-gradient text-white":1===e.clientType,"bg-info  bg-gradient text-white":2===e.clientType,"bg-success bg-gradient text-white":3===e.clientType,"bg-warning bg-gradient text-white":4===e.clientType},attrs:{tile:"",size:"80"}},[i("span",{staticClass:"h4 p-0 m-0 "},[i("b",[t._v(t._s(t._f("short")(e.name)))])])])]],2),i("v-card-actions",[i("div",{staticClass:"d-flex justify-content-between w-100"},[i("div",[i("v-btn",{attrs:{color:"#000",text:""},on:{click:function(i){return t.showDialog(e.id)}}},[t._v(" Подробнее ")])],1),i("div",[e.inArchive?i("v-btn",{attrs:{color:"#3599dc",text:""},on:{click:function(i){return t.archiveClient(e.id)}}},[t._v(" Вернуть из архива ")]):i("v-btn",{attrs:{color:"#DC3545",text:""},on:{click:function(i){return t.archiveClient(e.id)}}},[t._v(" В архив ")])],1)])])],1)],1)})):i("v-alert",{attrs:{dense:"",icon:"mdi-information-outline",text:"",color:"orange"}},[i("span",[t._v("Поиск не дал результата или сервер не отвечает={ Уточните пожалуйста параметры поиска.")])])],2),i("app-client-window",{ref:"clientWindow",on:{closeDialog:function(e){return t.closeDialog(e)},showAlert:function(e){return t.$emit("showAlert",e)}}})],1),i("v-btn",{staticClass:"mx-2 orange btn-add",attrs:{fab:""},on:{click:function(e){return t.showDialog()}}},[i("v-icon",{attrs:{dark:""}},[t._v(" mdi-plus ")])],1)],1)},P=[],$=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{wrap:t.dialogShow}},[i("v-dialog",{attrs:{value:t.dialogShow,persistent:"",scrollable:"","max-width":"1200px"}},[i("v-card",[i("v-card-title",{staticClass:"text-center bg-light "},[t.client.id?i("div",{staticClass:"h3 "},[t._v(t._s(t.client.nazvanie))]):i("div",{staticClass:"h3 "},[t._v("Новый клиент")]),i("div",{staticClass:"ms-auto"},[i("button",{staticClass:"close-btn",on:{click:t.closeDialog}},[i("v-icon",[t._v(" mdi-close-circle ")])],1)])]),i("v-card-text",[i("v-tabs",{attrs:{"background-color":"transparent",color:"#ffa900",grow:""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[i("v-tab",[t._v(" Контакты ")]),t.client.id?i("v-tab",[t._v(" Фотоотчеты и РП ")]):t._e()],1),i("v-tabs-items",{model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[i("v-tab-item",[i("v-card",{staticClass:"py-3 ",attrs:{color:"basil",flat:""}},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-4"},[i("v-text-field",{attrs:{label:"Наименование*"},model:{value:t.client.name,callback:function(e){t.$set(t.client,"name",e)},expression:"client.name"}})],1),i("div",{staticClass:"col-4"},[i("v-text-field",{attrs:{label:"ИНН"},model:{value:t.client.inn,callback:function(e){t.$set(t.client,"inn",e)},expression:"client.inn"}})],1),i("div",{staticClass:"col-4"},[i("v-select",{attrs:{label:"Тип клиента*","item-text":"label","item-value":"id",items:t.clientTypeList},model:{value:t.client.clientType,callback:function(e){t.$set(t.client,"clientType",e)},expression:"client.clientType"}})],1),i("div",{staticClass:"col-4"},[i("v-text-field",{attrs:{label:"ФИО ответственного лица"},model:{value:t.client.fioResponsible,callback:function(e){t.$set(t.client,"fioResponsible",e)},expression:"client.fioResponsible"}})],1),i("div",{staticClass:"col-4"},[i("v-text-field",{attrs:{label:"Телефон ответственного лица"},model:{value:t.client.phoneResponsible,callback:function(e){t.$set(t.client,"phoneResponsible",e)},expression:"client.phoneResponsible"}})],1),i("div",{staticClass:"col-4"},[i("v-text-field",{attrs:{label:"Email ответственного лица"},model:{value:t.client.emailResponsible,callback:function(e){t.$set(t.client,"emailResponsible",e)},expression:"client.emailResponsible"}})],1),i("div",{staticClass:"col-12"},[i("v-textarea",{attrs:{outlined:"",rows:"3",label:"Примечание"},model:{value:t.client.note,callback:function(e){t.$set(t.client,"note",e)},expression:"client.note"}})],1),i("div",{staticClass:"col-12"},[i("v-btn",{attrs:{color:"warning",dark:""},on:{click:function(e){return t.saveClient()}}},[i("v-icon",[t._v(" mdi-content-save ")]),t._v(" Сохранить ")],1)],1)])])],1),t.client.id?i("v-tab-item",[t.client.advertisingProgramList.length>0?i("v-simple-table",{staticClass:"mt-3",scopedSlots:t._u([{key:"default",fn:function(){return[i("thead",[i("tr",[i("th",{staticClass:"text-left"},[t._v(" Период ")]),i("th",{staticClass:"text-center"},[t._v(" Бюджет ")]),i("th",{staticClass:"text-center"},[t._v(" Домов ")]),i("th",{staticClass:"text-center"},[t._v(" Лифтов ")]),i("th",{staticClass:"text-center"},[t._v(" Фотоотчет ")]),i("th",{staticClass:"text-center"},[t._v(" Список домов ")])])]),i("tbody",t._l(t.client.advertisingProgramList,(function(e){return i("tr",{key:e.period},[i("td",[t._v(t._s(e.period)+" ("+t._s(e.rpCount)+" рп.)")]),i("td",{staticClass:"text-center"},[t._v(t._s(e.budget))]),i("td",{staticClass:"text-center"},[t._v(t._s(e.houseCount))]),i("td",{staticClass:"text-center"},[t._v(t._s(e.elevatorCount))]),i("td",{staticClass:"text-center"},[i("a",{staticClass:"text-warning",attrs:{href:e.photoReportLink,target:"_blank"}},[i("b",[t._v(" "+t._s(e.photoReportLink))])])]),i("td",{staticClass:"text-center"},[i("a",{staticClass:"text-warning",attrs:{href:e.excelReportLink,target:"_blank"}},[i("b",[t._v(" Скачать Excel")])])])])})),0)]},proxy:!0}],null,!1,3334690691)}):i("v-alert",{staticClass:"mt-3",attrs:{dense:"",icon:"mdi-information-outline",text:"",color:"orange"}},[i("span",[t._v("У клиента пока нет рекламных программ")])])],1):t._e()],1)],1)],1)],1)],1)},D=[],T={name:"AppClientWindow",data(){return{tab:0,client:{},dialogShow:!1,clientTypeList:n.clientTypeList,yesNoList:n.yesNoList}},methods:{resetClient:function(){this.tab=0,this.client={id:null,name:"",accessToken:"",clientType:1,inn:"",fioResponsible:"",phoneResponsible:"",emailResponsible:"",note:"",advertisingProgramList:[]}},closeDialog:function(){this.dialogShow=!1,this.resetClient(),this.$emit("closeDialog",{})},async openDialog(t){t?await this.getClient(t):this.resetClient(),this.dialogShow=!0},async getClient(t){const e=`${n.urls.client}${t}/`,i=await fetch(e);this.client=await i.json()},validateSaveData(){const t=void 0!==this.client.name&&this.client.name.length>0,e=void 0!==this.client.clientType&&""!==this.clientType;return t&&e},async saveClient(){const t=this.client.id?`${this.client.id}/`:"",e=this.client.id?"PUT":"POST";if(!this.validateSaveData())return this.$emit("showAlert","Не все поля  со звездочкой * заполнены"),!1;const i=`${n.urls.client}${t}`;try{const t=await fetch(i,{method:e,body:JSON.stringify(this.client),headers:{"Content-Type":"application/json","X-CSRFToken":l.getCookie("csrftoken")}});200===t.status||201===t.status?(this.$emit("showAlert","Данные сохранены"),this.$emit("closeDialog"),this.closeDialog()):this.$emit("showAlert",await t.text())}catch(s){this.$emit("showAlert","Ошибка при обращение к серверу")}}}},j=T,H=(0,h.Z)(j,$,D,!1,null,"19fe528d",null),F=H.exports,R={name:"ClientiView",components:{AppClientWindow:F},data(){return{ajaxLoad:!1,clientsList:[],dialogShow:!1,curentclient:{},clientCount:0,filterAndSort:{orderBy:"name",search:"",clientType:"",inArchive:!1},clientTypeList:[{id:"",label:"-"},...n.clientTypeList],sortList:[{id:"name",label:"Наименования от А до Я"},{id:"-name",label:"Наименования от Я до А"}],yesNoList:n.yesNoList}},methods:{showDialog(t=null){this.$refs.clientWindow.openDialog(t)},async archiveClient(t){this.ajaxLoad=!0;const e=`${n.urls.client}${t}/`;await fetch(e,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":l.getCookie("csrftoken")}}),this.getList(),this.ajaxLoad=!1},closeDialog(){this.getList()},resetFilterAndSort(){this.filterAndSort={orderBy:"name",search:"",clientType:"",inArchive:!1},this.getList()},async getList(){this.ajaxLoad=!0;const t=`${n.urls.client}?`+new URLSearchParams(this.filterAndSort),e=await fetch(t),i=await e.json();this.clientsList=i["data"],this.clientCount=i["count"],this.ajaxLoad=!1}},async created(){await this.getList(),this.$emit("loadComplete")},watch:{"filterAndSort.orderBy"(){this.getList()},"filterAndSort.clientType"(){this.getList()},"filterAndSort.inArchive"(){this.getList()}},filters:{short:function(t){return t.length>=2?t[0]+t[1]:1===t.length?t[0]:t}}},B=R,E=(0,h.Z)(B,L,P,!1,null,"5a88852a",null),N=E.exports,I=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"w-100 px-3 pt-2  d-flex flex-column "},[i("div",{staticClass:"panel-filtrov row "},[i("div",{staticClass:"col-12"},[i("h1",[t._v("Дома и лифты")]),i("div",{staticClass:"row poisk-i-filtri"},[i("div",{staticClass:"col-12 col-lg-3 mb-3 mb-lg-0"},[i("v-text-field",{attrs:{label:"Поиск дома"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getList.apply(null,arguments)},blur:t.getList},model:{value:t.filterAndSort.address,callback:function(e){t.$set(t.filterAndSort,"address",e)},expression:"filterAndSort.address"}})],1),i("div",{staticClass:"col-12 col-lg-2 mb-3 mb-lg-0"},[i("v-select",{attrs:{label:"Сортировка по:","item-text":"label","item-value":"id",items:t.orderByList},model:{value:t.filterAndSort.orderBy,callback:function(e){t.$set(t.filterAndSort,"orderBy",e)},expression:"filterAndSort.orderBy"}})],1),i("div",{staticClass:"col-12 col-lg-2 mb-3 mb-lg-0"},[i("v-select",{attrs:{label:"В архиве","item-text":"label","item-value":"id",items:t.yesNoNullList},model:{value:t.filterAndSort.inArchive,callback:function(e){t.$set(t.filterAndSort,"inArchive",e)},expression:"filterAndSort.inArchive"}})],1),i("div",{staticClass:"col-12 col-lg-2 mb-3 mb-lg-0"},[i("v-select",{attrs:{label:"Расклейщик","item-text":"fio","item-value":"id",items:t.placemarkerList},model:{value:t.filterAndSort.placemarker,callback:function(e){t.$set(t.filterAndSort,"placemarker",e)},expression:"filterAndSort.placemarker"}})],1),i("div",{staticClass:"col-12 col-lg-3 text-right"},[i("v-btn",{staticClass:"ms-auto shadow ",attrs:{color:"orange",dark:""},on:{click:function(e){return t.houseCreatePhotoDirFtp()}}},[t._v(" FTP: Создать каталоги ")])],1)]),i("div",{},[i("span",{staticClass:"small"},[t._v("Отображается: "+t._s(t.houseList.length)+" из "+t._s(t.houseServerCount))]),i("a",{staticClass:"small ms-2 d-inline-block text-warning",on:{click:function(e){return t.resetFilterAndSort()}}},[t._v("(Сбросить фильтры)")])])])]),i("v-progress-linear",{staticClass:"mt-3",attrs:{indeterminate:"",active:t.ajaxLoad,color:"yellow darken-2"}}),i("div",{staticClass:"tabliza-spiska-domov row"},[i("div",{staticClass:"col-12"},[t.houseList.length>0?i("v-simple-table",{attrs:{"fixed-header":"",height:"700px"},scopedSlots:t._u([{key:"default",fn:function(){return[i("thead",[i("tr",[i("th",{staticClass:"text-left"},[t._v(" Адрес ")]),i("th",{staticClass:"text-left"},[t._v(" Лифтов ")]),i("th",{staticClass:"text-left"},[t._v(" Всего места для А4 ")]),i("th",{staticClass:"text-left"},[t._v(" Индекс сортировки ")]),i("th",{staticClass:"text-left"},[t._v(" Расклейщик ")]),i("th",{staticClass:"text-left"},[t._v(" В архиве ")])])]),i("tbody",t._l(t.houseList,(function(e){return i("tr",{key:e.address,staticClass:"pointer-cursor",on:{click:function(i){return t.showDialog(e.id)}}},[i("td",[t._v(t._s(e.address))]),i("td",[t._v(t._s(e.elevatorCount))]),i("td",[t._v(t._s(e.advertisingSpace))]),i("td",[t._v(t._s(e.orderIndex))]),i("td",[t._v(t._s(e.placemarkerFio))]),i("td",[t._v(t._s(t._f("isInArchive")(e.inArchive)))])])})),0)]},proxy:!0}],null,!1,3382982831)}):i("v-alert",{attrs:{dense:"",icon:"mdi-information-outline",text:"",color:"orange"}},[i("span",[t._v("Поиск не дал результата или сервер не отвечает={ Уточните пожалуйста параметры поиска.")])])],1)]),i("app-house-window",{ref:"houseWindow",on:{closeDialog:function(e){return t.closeDialog(e)},showAlert:function(e){return t.$emit("showAlert",e)}}}),i("div",{staticClass:"knopki-upravlenia-kontentom"},[i("v-btn",{staticClass:"mx-2 orange btn-add",attrs:{fab:""},on:{click:function(e){return t.showDialog()}}},[i("v-icon",{attrs:{dark:""}},[t._v(" mdi-plus ")])],1)],1)],1)},O=[],W=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{wrap:t.dialogShow}},[i("v-dialog",{attrs:{value:t.dialogShow,persistent:"",scrollable:"","max-width":"1200px"}},[i("v-card",[i("v-card-title",{staticClass:"text-center bg-light "},[t.house.id?i("div",{staticClass:"h3 "},[t._v(t._s(t.house.address))]):i("div",{staticClass:"h3 "},[t._v("Новый дом")]),i("div",{staticClass:"ms-auto"},[i("button",{staticClass:"close-btn",on:{click:function(e){return t.closeDialog()}}},[i("v-icon",[t._v(" mdi-close-circle ")])],1)])]),i("v-card-text",[i("div",{staticClass:"row"},[i("div",{staticClass:"col-12 mb-3"},[i("v-text-field",{attrs:{label:"Адрес*"},model:{value:t.house.address,callback:function(e){t.$set(t.house,"address",e)},expression:"house.address"}})],1),i("div",{staticClass:"col-6"},[i("v-text-field",{attrs:{label:"Количество лифтов*"},model:{value:t.house.elevatorCount,callback:function(e){t.$set(t.house,"elevatorCount",e)},expression:"house.elevatorCount"}})],1),i("div",{staticClass:"col-6"},[i("v-select",{attrs:{label:"Тип лифтборда*","item-text":"name","item-value":"id",items:t.liftboardLayoutList},model:{value:t.house.liftboardLayout,callback:function(e){t.$set(t.house,"liftboardLayout",e)},expression:"house.liftboardLayout"}})],1),i("div",{staticClass:"col-6"},[i("v-text-field",{attrs:{label:"Индекс сортировки(больше-раньше)",type:"number"},model:{value:t.house.orderIndex,callback:function(e){t.$set(t.house,"orderIndex",e)},expression:"house.orderIndex"}})],1),i("div",{staticClass:"col-6"},[i("v-select",{attrs:{label:"Расклейщик","item-text":"fio","item-value":"id",items:t.placemarkerList},model:{value:t.house.placemarker,callback:function(e){t.$set(t.house,"placemarker",e)},expression:"house.placemarker"}})],1)]),i("div",{staticClass:"row"},[i("div",{staticClass:"col-6"},[i("v-btn",{attrs:{color:"warning",dark:""},on:{click:function(e){return t.saveHouse()}}},[i("v-icon",[t._v(" mdi-content-save ")]),t._v(" Сохранить ")],1)],1),t.house.id?i("div",{staticClass:"col-6 text-right"},[t.house.inArchive?i("v-btn",{attrs:{color:"#3599dc",text:""},on:{click:function(e){return t.archiveHouse(t.house.id)}}},[t._v(" Вернуть из архива ")]):i("v-btn",{attrs:{color:"#DC3545",text:""},on:{click:function(e){return t.archiveHouse(t.house.id)}}},[t._v(" В архив ")])],1):t._e()])])],1)],1)],1)},z=[],U={name:"AppHouseWindow",data(){return{house:{id:null,address:"",elevatorCount:1,liftboardLayout:1,orderIndex:0,placemarker:null,inArchive:!1},dialogShow:!1,liftboardLayoutList:[],placemarkerList:[]}},methods:{resetHouse(){this.house={id:null,address:"",placemarker:null,elevatorCount:1,liftboardLayout:1,orderIndex:0,inArchive:!1}},validateSaveData(){const t=void 0!==this.house.address&&this.house.address.length>0,e=void 0!==this.house.elevatorCount&&this.house.elevatorCount>0,i=void 0!==this.house.liftboardLayout;return t&&e&&i},async archiveHouse(t){try{const e=`${n.urls.house}${t}/`,i=await fetch(e,{method:"delete",headers:{"Content-Type":"application/json","X-CSRFToken":l.getCookie("csrftoken")}});200===i.status||201===i.status?(this.$emit("showAlert","Данные сохранены"),this.$emit("closeDialog"),this.closeDialog()):this.$emit("showAlert",await i.text())}catch(e){this.$emit("showAlert","Ошибка при обращение к серверу")}},async getHouse(t){const e=`${n.urls.house}${t}/`,i=await fetch(e);this.house=await i.json()},async getLiftboardLayout(){const t=`${n.urls.liftboardLayout}`,e=await fetch(t);this.liftboardLayoutList=await e.json()},async getPlacemarkerList(){const t=`${n.urls.placemarker}`,e=await fetch(t);this.placemarkerList=await e.json()},async saveHouse(){const t=this.house.id?`${this.house.id}/`:"",e=this.house.id?"PUT":"POST";if(!this.validateSaveData())return this.$emit("showAlert","Не все поля заполнены"),!1;const i=`${n.urls.house}${t}`;try{const t=await fetch(i,{method:e,body:JSON.stringify(this.house),headers:{"Content-Type":"application/json","X-CSRFToken":l.getCookie("csrftoken")}});200===t.status||201===t.status?(this.$emit("showAlert","Данные сохранены"),this.$emit("closeDialog"),this.closeDialog()):this.$emit("showAlert",await t.text())}catch(s){this.$emit("showAlert","Ошибка при обращение к серверу")}},closeDialog:function(){this.dialogShow=!1,this.resetHouse(),this.$emit("closeDialog",{})},async openDialog(t){await this.getLiftboardLayout(),await this.getPlacemarkerList(),t?await this.getHouse(t):this.resetHouse(),this.dialogShow=!0}}},M=U,Z=(0,h.Z)(M,W,z,!1,null,"7ef73a8e",null),X=Z.exports,V={name:"HouseView",components:{AppHouseWindow:X},data(){return{houseList:[],ajaxLoad:!1,filterAndSort:{orderBy:"-order_index",address:"",inArchive:!1},placemarkerList:[],houseServerCount:0,orderByList:[{id:"address",label:"Наименования от А до Я"},{id:"-address",label:"Наименования от Я до А"},{id:"-order_index",label:"Согласно КП"}],yesNoNullList:n.yesNoList}},methods:{showDialog(t=null){this.$refs.houseWindow.openDialog(t)},closeDialog(){this.getList()},resetFilterAndSort(){this.filterAndSort={orderBy:"-order_index",address:"",inArchive:!1},this.getList()},async getPlacemarkerList(){const t=`${n.urls.placemarker}`,e=await fetch(t);this.placemarkerList=await e.json()},async getList(){this.ajaxLoad=!0;const t=n.urls.house+`?${new URLSearchParams(this.filterAndSort)}`,e=await fetch(t),i=await e.json();this.houseList=i.data,this.houseServerCount=i.count,this.ajaxLoad=!1},async houseCreatePhotoDirFtp(){try{const t=await fetch(n.urls.houseCreatePhotoDirFtp);200===t.status?this.$emit("showAlert","Список каталогов на FTP обновился"):this.$emit("showAlert","Ошибка при обращение к серверу")}catch(t){this.$emit("showAlert","Ошибка при обращение к серверу")}}},filters:{isInArchive:function(t){return t?"В архиве":"Нет"}},async created(){await this.getPlacemarkerList(),await this.getList(),this.$emit("loadComplete")},watch:{"filterAndSort.orderBy"(){this.getList()},"filterAndSort.inArchive"(){this.getList()},"filterAndSort.placemarker"(){this.getList()}}},J=V,G=(0,h.Z)(J,I,O,!1,null,"40353262",null),K=G.exports,q=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"w-100 px-3 pt-2  d-flex flex-column mb-5 ap-view"},[i("div",{staticClass:"row "},[i("div",{staticClass:"col-12"},[i("h1",[t._v("Реклама")]),i("div",{staticClass:"row"},[i("div",{staticClass:"col-2"},[i("v-text-field",{attrs:{label:"Поиск по адресу"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getList.apply(null,arguments)},blur:t.getList},model:{value:t.filterAndSort.searchAddress,callback:function(e){t.$set(t.filterAndSort,"searchAddress",e)},expression:"filterAndSort.searchAddress"}})],1),i("div",{staticClass:"col-2"},[i("v-text-field",{attrs:{label:"Поиск по клиенту"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getList.apply(null,arguments)},blur:t.getList},model:{value:t.filterAndSort.searchClient,callback:function(e){t.$set(t.filterAndSort,"searchClient",e)},expression:"filterAndSort.searchClient"}})],1),i("div",{staticClass:"col-2"},[i("v-select",{attrs:{label:"Занятость и конфликты",items:t.bysyAndConflictList,"item-text":"label","item-value":"id"},model:{value:t.filterAndSort.bysyAndConflict,callback:function(e){t.$set(t.filterAndSort,"bysyAndConflict",e)},expression:"filterAndSort.bysyAndConflict"}})],1),i("div",{staticClass:"col-2"},[i("v-select",{attrs:{label:"Достаточность фото",items:t.hasPhotoList,"item-text":"label","item-value":"id"},model:{value:t.filterAndSort.hasPhoto,callback:function(e){t.$set(t.filterAndSort,"hasPhoto",e)},expression:"filterAndSort.hasPhoto"}})],1),i("div",{staticClass:"col-2"},[i("v-select",{attrs:{label:"Сортировка по:","item-text":"label","item-value":"id",items:t.orderByList},model:{value:t.filterAndSort.orderBy,callback:function(e){t.$set(t.filterAndSort,"orderBy",e)},expression:"filterAndSort.orderBy"}})],1),i("div",{staticClass:"col-2"},[i("v-select",{attrs:{label:"Период","item-text":"name","item-value":"slug",items:t.periodList},model:{value:t.filterAndSort.period,callback:function(e){t.$set(t.filterAndSort,"period",e)},expression:"filterAndSort.period"}})],1)]),i("div",{},[i("span",{staticClass:"small"},[t._v("Отображается: "+t._s(t.countHouseAfterFilter)+" домов ("+t._s(t.countElevatorAfterFilter)+" лифтов) из "+t._s(t.countHouseAll)+" домов ("+t._s(t.countElevatorAll)+" лифтов)")]),i("a",{staticClass:"small ms-2 d-inline-block text-warning",attrs:{href:"#"},on:{click:t.resetFilterAndSort}},[t._v("(Сбросить фильтры)")])]),i("div",{staticClass:"row"},[t.statistic?i("div",{staticClass:"col-12"},[i("v-chip",{staticClass:"ma-2 shadow",attrs:{small:"",color:"white"}},[t._v(" Всего: "+t._s(t.statistic.areaCount)+" шт. ")]),i("v-chip",{staticClass:"ma-2 shadow mr-5",attrs:{small:"",color:"white"}},[t._v(" Свободных: "+t._s(t.statistic.freeCount)+" шт. ("+t._s(t.statistic.freePercent)+"%) ")]),i("v-chip",{staticClass:"ma-2 shadow",attrs:{small:"",color:"primary",outlined:1!==t.filterAndSort.clientType},on:{click:function(e){return t.setFilterClientType(1)}}},[i("b",[t._v("Рекламных: "+t._s(t.statistic.advertiserCount)+" шт. ("+t._s(t.statistic.advertiserPercent)+"%)")])]),i("v-chip",{staticClass:"ma-2 text-white shadow",attrs:{small:"",color:"green",outlined:3!==t.filterAndSort.clientType},on:{click:function(e){return t.setFilterClientType(3)}}},[i("b",[t._v("Партнеры: "+t._s(t.statistic.partnerCount)+" шт. ("+t._s(t.statistic.partnerPercent)+"%)")])]),i("v-chip",{staticClass:"ma-2 shadow",attrs:{small:"",color:"info",outlined:2!==t.filterAndSort.clientType},on:{click:function(e){return t.setFilterClientType(2)}}},[i("b",[t._v("ТСЖ/УК: "+t._s(t.statistic.tszUkCount)+" шт. ("+t._s(t.statistic.tszUkPercent)+"%)")])]),i("v-chip",{staticClass:"ma-2 text-white shadow",attrs:{small:"",color:"orange",outlined:4!==t.filterAndSort.clientType},on:{click:function(e){return t.setFilterClientType(4)}}},[i("b",[t._v("Кенгуру: "+t._s(t.statistic.kenguruCount)+" шт. ("+t._s(t.statistic.kenguruPercent)+"%)")])]),i("v-chip",{staticClass:"ma-2 text-white shadow ml-5",attrs:{small:"",color:"purple",outlined:1!==t.filterAndSort.statusAdvertisingProgram},on:{click:function(e){return t.setFilterStatusAdvertisingProgram(1)}}},[i("b",[t._v("Новые: "+t._s(t.statistic.newCount)+" шт. ("+t._s(t.statistic.newPercent)+"%)")])]),i("v-chip",{staticClass:"ma-2 text-white shadow",attrs:{small:"",color:"pink",outlined:2!==t.filterAndSort.statusAdvertisingProgram},on:{click:function(e){return t.setFilterStatusAdvertisingProgram(2)}}},[i("b",[t._v("Продление: "+t._s(t.statistic.prolongCount)+" шт. ("+t._s(t.statistic.prolongPercent)+"%)")])]),i("v-chip",{staticClass:"ma-2 text-white shadow",attrs:{small:"",color:"deep-purple",outlined:3!==t.filterAndSort.statusAdvertisingProgram},on:{click:function(e){return t.setFilterStatusAdvertisingProgram(3)}}},[i("b",[t._v("Замены: "+t._s(t.statistic.changingLayoutCount)+" шт. ("+t._s(t.statistic.changingLayoutPercent)+"%)")])])],1):t._e()]),i("div",{},[i("v-progress-linear",{staticClass:"mt-3",attrs:{indeterminate:"",active:t.ajaxLoad,color:"yellow darken-2"}})],1)])]),[t.advertisingProgramList.length>0?i("div",{staticClass:"row"},[t.isListView?t._l(t.advertisingProgramList,(function(e,s){return i("div",{key:s,staticClass:"col-2"},[i("app-advertising-program-list-card",{attrs:{house:e},on:{showDialog:function(e){return t.showDialog(e)},openChangePositionWindow:function(e){return t.openChangePositionWindow(e)}}})],1)})):t._l(t.advertisingProgramList,(function(e,s){return i("div",{key:s,staticClass:"col-3"},[t._v(" "+t._s(e.address)+" ")])}))],2):i("v-alert",{attrs:{dense:"",icon:"mdi-information-outline",text:"",color:"orange"}},[i("span",[t._v("Поиск не дал результата или сервер не отвечает={ Уточните пожалуйста параметры поиска.")])])],i("div",{staticClass:"row"},[i("div",{staticClass:"col-12"},[i("v-pagination",{staticClass:"my-4",attrs:{color:"orange",circle:"",length:t.pageCount},model:{value:t.filterAndSort.page,callback:function(e){t.$set(t.filterAndSort,"page",e)},expression:"filterAndSort.page"}})],1)]),i("div",{staticClass:"row"},[i("div",{staticClass:"col-12 text-center"},[i("v-btn",{attrs:{color:"orange accent-1",fab:""},on:{click:function(e){t.showStatistic=!t.showStatistic}}},[i("v-icon",{attrs:{dark:""}},[t._v(" mdi mdi-menu ")])],1)],1),t.showStatistic?t._l(t.statistic.statusStatistic,(function(e,s){return i("div",{key:s,staticClass:"col-12 py-0"},[i("p",{staticClass:"py-1 my-0"},[i("b",{staticClass:"pointer-cursor",on:{click:function(i){return t.showDialog(e.id)}}},[t._v(t._s(s+1)+". "+t._s(e.ap)+" - "+t._s(e.countElevator)+" лифтов ("+t._s(e.statusDispaly)+")")])])])})):t._e()],2),i("app-advertising-program-window",{ref:"apWindow",attrs:{period:t.filterAndSort.period},on:{closeDialog:function(e){return t.closeDialog(e)},showAlert:function(e){return t.$emit("showAlert",e)}}}),i("app-advertising-program-edit-window",{ref:"apChangePositionWindow",on:{closeDialog:function(e){return t.closeDialog(e)},showAlert:function(e){return t.$emit("showAlert",e)}}}),i("app-advertising-program-prolong-window",{ref:"apProlongWindow",on:{closeDialog:function(e){return t.closeDialog(e)},showAlert:function(e){return t.$emit("showAlert",e)}}}),i("app-advertising-program-merge-window",{ref:"advertisingProgramMergeWindow",on:{closeDialog:function(e){return t.closeDialog(e)},showAlert:function(e){return t.$emit("showAlert",e)}}})],2),i("v-btn",{staticClass:"mx-2 orange btn-add",attrs:{fab:""},on:{click:function(e){return t.showDialog()}}},[i("v-icon",{attrs:{dark:""}},[t._v(" mdi-pencil-outline ")])],1),i("v-btn",{staticClass:"mx-2 orange btn-prolong",attrs:{fab:""},on:{click:function(e){return t.openApProlongWindow(t.filterAndSort.period)}}},[i("v-icon",{attrs:{dark:""}},[t._v(" mdi-calendar-month-outline ")])],1),i("v-btn",{staticClass:"mx-2 orange btn-merge",attrs:{fab:""},on:{click:function(e){return t.openMergeWindow(t.filterAndSort.period)}}},[i("v-icon",{attrs:{dark:""}},[t._v(" mdi-source-merge ")])],1),i("v-btn",{staticClass:"mx-2 shadow btn-render-adhesive-sheet",attrs:{color:"orange",dark:"",target:"_blank",fab:"",href:t.linkRenderAdhesiveSheet}},[i("v-icon",[t._v("mdi-file-excel")])],1)],1)},Q=[],Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"position-relative",class:{wrap:t.dialogShow}},[i("v-dialog",{attrs:{value:t.dialogShow,persistent:"",scrollable:"","max-width":"1200px"}},[i("v-card",[i("v-card-title",{staticClass:"text-center bg-light "},[t.advertisingProgram.id?i("div",{staticClass:"h3 "},[t._v("Редактирование РП для «"+t._s(t.advertisingProgram.clientName)+"» ")]):""===t.advertisingProgram?i("div",{staticClass:"h3 "},[t._v("Список РП")]):i("div",{staticClass:"h3 "},[t._v("Новая РП")]),i("div",{staticClass:"ms-auto"},[i("button",{staticClass:"close-btn",on:{click:t.closeDialog}},[i("v-icon",[t._v(" mdi-close-circle ")])],1)])]),i("v-card-text",[i("v-tabs",{attrs:{"background-color":"transparent",color:"#ffa900",grow:""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[i("v-tab",[t._v(" Шаг 1. Список РП ")]),i("v-tab",{attrs:{disabled:""===t.advertisingProgram}},[t._v(" Шаг 2. Клиент ")]),i("v-tab",{attrs:{disabled:""===t.advertisingProgram}},[t._v(" Шаг 3. Лифты ")])],1),i("v-tabs-items",{model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[i("v-tab-item",[i("v-card",{staticClass:"py-3 ",attrs:{color:"basil",flat:""}},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-3"},[i("v-text-field",{attrs:{label:"Поиск по клиенту"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getAdvertisingProgramList.apply(null,arguments)},blur:t.getAdvertisingProgramList},model:{value:t.filterAndSortRp.clientName,callback:function(e){t.$set(t.filterAndSortRp,"clientName",e)},expression:"filterAndSortRp.clientName"}})],1),i("div",{staticClass:"col-3"},[i("v-select",{attrs:{label:"Тип клиента",items:t.clientTypeList,"item-text":"label","item-value":"id"},model:{value:t.filterAndSortRp.clientType,callback:function(e){t.$set(t.filterAndSortRp,"clientType",e)},expression:"filterAndSortRp.clientType"}})],1),i("div",{staticClass:"col-2"},[i("v-select",{attrs:{label:"Сортировка по:","item-text":"label","item-value":"id",items:t.orderByListRp},model:{value:t.filterAndSortRp.orderBy,callback:function(e){t.$set(t.filterAndSortRp,"orderBy",e)},expression:"filterAndSortRp.orderBy"}})],1),i("div",{staticClass:"col-2"},[i("v-select",{attrs:{label:"В архиве",items:t.yesNoList,"item-text":"label","item-value":"id"},model:{value:t.filterAndSortRp.inArchive,callback:function(e){t.$set(t.filterAndSortRp,"inArchive",e)},expression:"filterAndSortRp.inArchive"}})],1),i("div",{staticClass:"col-2"},[i("v-select",{attrs:{label:"Итоговая",items:t.yesNoNullList,"item-text":"label","item-value":"id"},model:{value:t.filterAndSortRp.isComplete,callback:function(e){t.$set(t.filterAndSortRp,"isComplete",e)},expression:"filterAndSortRp.isComplete"}})],1)]),i("div",{},[i("div",{},[i("span",{staticClass:"small"},[t._v("Отображается: "+t._s(t.advertisingProgramList.length)+" РП из "+t._s(t.advertisingProgramCount)+" РП")]),i("a",{staticClass:"small ms-2 d-inline-block text-warning",attrs:{href:"#"},on:{click:function(e){return t.resetAdvertisingProgram()}}},[t._v("(Сбростиь фильтры)")])]),i("v-progress-linear",{staticClass:"mt-3",attrs:{indeterminate:"",active:t.ajaxLoadAdvertisingProgram,color:"yellow darken-2"}})],1),!1===t.ajaxLoadAdvertisingProgram?[t.advertisingProgramList.length>0?i("v-simple-table",{attrs:{"fixed-header":"",height:"300px"},scopedSlots:t._u([{key:"default",fn:function(){return[i("thead",[i("tr",[i("th",{staticClass:"text-left"},[t._v(" Клиент ")]),i("th",{staticClass:"text-left"},[t._v(" Тип клиента ")]),i("th",{staticClass:"text-left"},[t._v(" Кол-во домов ")]),i("th",{staticClass:"text-left"},[t._v(" Кол-во лифтов ")]),i("th",{staticClass:"text-left"},[t._v(" Бюджет ")]),i("th",{staticClass:"text-left"},[t._v(" Формат ")]),i("th",{staticClass:"text-left"},[t._v(" Желаемое положение ")]),i("th",{staticClass:"text-left",attrs:{width:"180"}},[t._v(" Архив ")]),i("th",{staticClass:"text-left",attrs:{width:"180"}},[t._v(" Итоговая? ")])])]),i("tbody",t._l(t.advertisingProgramList,(function(e){return i("tr",{key:e.id,staticClass:"pointer-cursor",on:{click:function(i){return t.getAdvertisingProgramDetail(e.id)}}},[i("td",{class:{"text-info":2===e.clientTypeId,"text-success":3===e.clientTypeId,"text-warning":4===e.clientTypeId}},[t._v(t._s(e.clientName)+" "+t._s(e.note)+" ")]),i("td",{class:{"text-info":2===e.clientTypeId,"text-success":3===e.clientTypeId,"text-warning":4===e.clientTypeId}},[t._v(t._s(e.clientTypeDisplay)+" ")]),i("td",[t._v(t._s(e.houseCount))]),i("td",[t._v(t._s(e.elevatorCount))]),i("td",[t._v(t._s(e.budget))]),i("td",[t._v(t._s(e.paperSizeDisplay))]),i("td",[t._v(t._s(e.elevatorPosition))]),i("td",{staticClass:"text-left "},[e.inArchive?i("v-btn",{attrs:{color:"#DC3545",text:""},on:{click:function(i){return i.stopPropagation(),t.archiveAdvertisingProgram(e.id)}}},[t._v(" Вернуть ")]):i("v-btn",{staticClass:"p-0",attrs:{color:"#3599dc",text:""},on:{click:function(i){return i.stopPropagation(),t.archiveAdvertisingProgram(e.id)}}},[t._v(" В архив ")])],1),i("td",{staticClass:"text-center"},[i("v-switch",{attrs:{color:"orange"},on:{click:function(i){return i.stopPropagation(),t.changeIsComplete(e.id,e.isComplete)}},model:{value:e.isComplete,callback:function(i){t.$set(e,"isComplete",i)},expression:"item.isComplete"}})],1)])})),0)]},proxy:!0}],null,!1,190847881)}):i("v-alert",{attrs:{dense:"",icon:"mdi-information-outline",text:"",color:"orange"}},[i("span",{staticClass:" mt-3 text-dark"},[t._v("Поиск не дал результата или РП за этот период нет ={")])])]:t._e(),i("v-btn",{staticClass:"mx-2 orange btn-add",attrs:{fab:"",dark:""},on:{click:function(e){return t.createAdvertisingProgram()}}},[i("v-icon",{attrs:{dark:""}},[t._v(" mdi-plus ")])],1)],2)],1),i("v-tab-item",[i("v-card",{staticClass:"py-3 ",attrs:{color:"basil",flat:""}},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-12"}),i("div",{staticClass:"col-6"},[i("v-autocomplete",{attrs:{label:"Клиент*","item-text":"name","item-value":"id",items:t.clientList},model:{value:t.advertisingProgram.client,callback:function(e){t.$set(t.advertisingProgram,"client",e)},expression:"advertisingProgram.client"}})],1),i("div",{staticClass:"col-6"},[i("v-text-field",{attrs:{label:"Примечание"},model:{value:t.advertisingProgram.note,callback:function(e){t.$set(t.advertisingProgram,"note",e)},expression:"advertisingProgram.note"}})],1),i("div",{staticClass:"col-6"},[i("v-select",{attrs:{label:"Формат*","item-text":"name","item-value":"id",items:t.paperSizeList},model:{value:t.advertisingProgram.paperSize,callback:function(e){t.$set(t.advertisingProgram,"paperSize",e)},expression:"advertisingProgram.paperSize"}})],1),i("div",{staticClass:"col-6"},[i("v-select",{attrs:{label:"Статус РП*","item-text":"label","item-value":"id",items:t.statusAdvertisingProgramList},model:{value:t.advertisingProgram.status,callback:function(e){t.$set(t.advertisingProgram,"status",e)},expression:"advertisingProgram.status"}})],1),i("div",{staticClass:"col-6"},[i("v-text-field",{attrs:{label:"Бюджет"},model:{value:t.advertisingProgram.budget,callback:function(e){t.$set(t.advertisingProgram,"budget",e)},expression:"advertisingProgram.budget"}})],1),i("div",{staticClass:"col-6"},[i("v-autocomplete",{attrs:{label:"Желаемое расположение","item-text":"name","item-value":"id",items:t.elevatorPositionList},model:{value:t.advertisingProgram.elevatorPosition,callback:function(e){t.$set(t.advertisingProgram,"elevatorPosition",e)},expression:"advertisingProgram.elevatorPosition"}})],1),i("div",{staticClass:"col-12 text-right"},[t.advertisingProgram.id?i("v-btn",{staticClass:"mr-4",attrs:{color:"orange",outlined:"",dark:""},on:{click:function(e){return t.advertisingProgramSave(!0)}}},[i("v-icon"),t._v(" Сохранить и обновить позиции ")],1):t._e(),i("v-btn",{attrs:{color:"orange",dark:""},on:{click:function(e){return t.advertisingProgramSave()}}},[i("v-icon",[t._v("mdi mdi-content-save")]),t._v(" Сохранить ")],1)],1)])])],1),i("v-tab-item",[i("v-card",{staticClass:"py-3 ",attrs:{color:"basil",flat:""}},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-3 pb-0"},[i("v-text-field",{attrs:{label:"Поиск дома"},scopedSlots:t._u([{key:"append-outer",fn:function(){return[i("v-icon",{on:{click:function(e){t.filterAndSortHome.address=""}}},[t._v("mdi-close")])]},proxy:!0}]),model:{value:t.filterAndSortHome.address,callback:function(e){t.$set(t.filterAndSortHome,"address",e)},expression:"filterAndSortHome.address"}})],1),i("div",{staticClass:"col-3 pb-0"},[i("v-select",{attrs:{label:"Сортировка по:","item-text":"label","item-value":"id",items:t.orderByListClient},model:{value:t.filterAndSortHome.orderBy,callback:function(e){t.$set(t.filterAndSortHome,"orderBy",e)},expression:"filterAndSortHome.orderBy"}})],1),i("div",{staticClass:"col-3 pb-0"},[i("v-select",{attrs:{label:"Скрывать дома где есть клиент","item-text":"label","item-value":"id",items:[{label:"Нет",id:0},{label:"Да",id:1}]},model:{value:t.filterAndSortHome.dontCurentClient,callback:function(e){t.$set(t.filterAndSortHome,"dontCurentClient",e)},expression:"filterAndSortHome.dontCurentClient"}})],1),i("div",{staticClass:"col-3 pb-0"},[i("v-select",{attrs:{label:"Скрывать занятые","item-text":"label","item-value":"id",items:t.homeShowBusyList},model:{value:t.filterAndSortHome.homeShowBusy,callback:function(e){t.$set(t.filterAndSortHome,"homeShowBusy",e)},expression:"filterAndSortHome.homeShowBusy"}})],1),i("div",{staticClass:"col-12 my-1 py-0"},[t.advertisingProgram.houseIdList?i("span",[t._v("Выбрано "+t._s(t.advertisingProgram.houseIdList.length)+" домов и "+t._s(t.selectElevatorCount)+" лифтов ")]):t._e()]),i("div",{staticClass:"col-12"},[t.homeListFiltred.length>0?i("div",[i("v-simple-table",{attrs:{"fixed-header":"",height:"300px"},scopedSlots:t._u([{key:"default",fn:function(){return[i("thead",[i("tr",[i("th",{staticClass:"text-left"}),i("th",{staticClass:"text-left"},[t._v(" Адрес ")]),i("th",{staticClass:"text-left"},[t._v(" Свобоно мест ")]),i("th",{staticClass:"text-left"},[t._v(" Лифтов в доме ")])])]),i("tbody",t._l(t.homeListFiltred,(function(e){return i("tr",{key:e.address},[i("td",[i("v-switch",{staticClass:"m-0 p-0",attrs:{color:"orange","hide-details":"",value:e.id},model:{value:t.advertisingProgram.houseIdList,callback:function(e){t.$set(t.advertisingProgram,"houseIdList",e)},expression:"advertisingProgram.houseIdList"}})],1),i("td",[t._v(t._s(e.address))]),i("td",[t._v(t._s(e.freeSpace))]),i("td",[t._v(t._s(e.elevatorCount))])])})),0)]},proxy:!0}],null,!1,1829628922)}),i("div",{staticClass:"row"},[i("div",{staticClass:"col-6"},[i("v-btn",{staticClass:"mr-3",attrs:{color:"orange",dark:"",outlined:"",text:""},on:{click:function(e){return t.checkSelectHome()}}},[i("v-icon",[t._v("mdi-checkbox-marked-outline")]),t._v(" Отметить выбранные ")],1),i("v-btn",{attrs:{color:"orange",dark:"",outlined:"",text:""},on:{click:function(e){return t.uncheckSelectHome()}}},[i("v-icon",[t._v("mdi-checkbox-blank-outline")]),t._v(" Снять выбранные ")],1)],1),i("div",{staticClass:"col-6 text-right"},[t.advertisingProgram.id?i("v-btn",{staticClass:"mr-4",attrs:{color:"orange",outlined:"",dark:""},on:{click:function(e){return t.advertisingProgramSave(!0)}}},[i("v-icon"),t._v(" Сохранить и обновить позиции ")],1):t._e(),i("v-btn",{attrs:{color:"orange",dark:""},on:{click:function(e){return t.advertisingProgramSave()}}},[i("v-icon",[t._v("mdi mdi-content-save")]),t._v(" Сохранить ")],1)],1)])],1):i("div",{staticClass:"text-center "},[i("b",[t._v("Дом не найдён. Уточните поиск...")])])])])])],1)],1)],1)],1)],1)],1)},tt=[],et={name:"AppAdvertisingProgramWindow",props:["period"],data(){return{advertisingProgramList:[],ajaxLoadAdvertisingProgram:!1,advertisingProgram:{client:0,houseIdList:[]},filterAndSortRp:{clientName:"",clientType:"",paperSize:"",inArchive:!1,isComplete:"",orderBy:"client__name"},advertisingProgramCount:"",clientTypeList:n.clientTypeList,orderByListRp:[{id:"client__name",label:"Наименования от А до Я"},{id:"-client__name",label:"Наименования от Я до А"}],paperSizeList:[],statusAdvertisingProgramList:n.statusAdvertisingProgramList,clientList:[],homeList:[],allHouseList:[],ajaxLoadHome:!1,filterAndSortHome:{orderBy:"-order_index",address:"",dontCurentClient:0,homeShowBusy:"free"},orderByListClient:[{id:"address",label:"Наименования от А до Я"},{id:"-address",label:"Наименования от Я до А"},{id:"-order_index",label:"Согласно КП"}],homeShowBusyList:[{id:"all",label:"Все"},{id:"free",label:"Только свободные"},{id:"bysy",label:"Только занятые"},{id:"select",label:"Только выбранные"}],yesNoNullList:n.yesNoNullList,yesNoList:n.yesNoList,tab:null,dialogShow:!1}},computed:{homeListFiltred:function(){const t=[];return this.homeList.forEach((e=>{const i="bysy"===this.filterAndSortHome.homeShowBusy&&e.freeSpace<=0,s="free"===this.filterAndSortHome.homeShowBusy&&e.freeSpace>0,a="all"===this.filterAndSortHome.homeShowBusy,r="select"===this.filterAndSortHome.homeShowBusy&&-1!==this.advertisingProgram.houseIdList.indexOf(e.id);(i||s||r||a)&&t.push(e)})),t},elevatorPositionList:function(){const t=8,e=this.paperSizeList.find((t=>t.id===this.advertisingProgram.paperSize));if(e){const i=[];for(let s=1;s<=t/e.ratioToA4;s++)i.push({name:s,id:s});return[{name:"Любое",id:null},...i]}return[{name:"Любое",id:null}]},selectElevatorCount:function(){let t=0;for(const e of this.advertisingProgram.houseIdList){const i=this.allHouseList.find((t=>t.id===e));i&&(t+=i.elevatorCount)}return t}},methods:{closeDialog:function(){this.dialogShow=!1,this.homeList=[],this.resetAdvertisingProgram(),this.tab=0,this.filterAndSortHome={orderBy:"-order_index",address:"",dontCurentClient:0,homeShowBusy:"free"},this.$emit("closeDialog",{})},async openDialog(t){this.resetAdvertisingProgram(),this.getClientList(),this.getHomeList(!0),t?await this.getAdvertisingProgramDetail(t):this.tab=0,this.dialogShow=!0},resetAdvertisingProgram:function(){this.filterAndSortRp={clientName:"",clientType:"",paperSize:"",inArchive:!1,isComplete:"",orderBy:"client__name"},this.advertisingProgram={client:0,houseIdList:[]},this.advertisingProgramCount=0,this.getAdvertisingProgramList()},createAdvertisingProgram:function(){this.advertisingProgram={houseIdList:[],client:"",budget:null,status:1,paperSize:1,elevatorPosition:null},this.tab=1,this.getHomeList(),this.filterAndSortHome.homeShowBusy="free"},async getAdvertisingProgramList(){this.ajaxLoadAdvertisingProgram=!0;const t=`${n.urls.advertisingProgram}${this.period}/?${new URLSearchParams(this.filterAndSortRp)}`,e=await fetch(t,{method:"get"}),i=await e.json();this.advertisingProgramList=i["data"],this.advertisingProgramCount=i["advertisingProgramCount"],this.ajaxLoadAdvertisingProgram=!1},async changeIsComplete(t,e){const i=`${n.urls.advertisingProgramChangeComplete}`,s=await fetch(i,{method:"post",body:JSON.stringify({id:t,isComplete:e}),headers:{"Content-Type":"application/json","X-CSRFToken":l.getCookie("csrftoken")}});200===s.status||201===s.status?this.$emit("showAlert","Данные сохранены"):this.$emit("showAlert",await s.text())},async getAdvertisingProgramDetail(t){const e=`${n.urls.advertisingProgram}${this.period}/${t}/`;try{const t=await fetch(e,{method:"get"}),i=await t.json();this.advertisingProgram=i,this.advertisingProgram.oldClientId=i.client,this.tab=1,this.filterAndSortHome.homeShowBusy="select",this.getHomeList()}catch(i){this.$emit("showAlert","Ошибка при обращение к серверу")}},async archiveAdvertisingProgram(t){const e=`${n.urls.advertisingProgram}${this.period}/${t}/`;try{const t=await fetch(e,{method:"delete",headers:{"Content-Type":"application/json","X-CSRFToken":l.getCookie("csrftoken")}});200===t.status||201===t.status?(this.$emit("showAlert","Данные сохранены"),this.getAdvertisingProgramList()):this.$emit("showAlert",await t.text())}catch(i){this.$emit("showAlert","Ошибка при обращение к серверу")}},validateSaveData(){const t=void 0!==this.advertisingProgram.client&&""!==this.advertisingProgram.client,e=void 0!==this.advertisingProgram.paperSize&&""!==this.advertisingProgram.paperSize,i=void 0!==this.advertisingProgram.status&&""!==this.advertisingProgram.status;return t&&e&&i},async advertisingProgramSave(t=!1){if(!this.validateSaveData())return this.$emit("showAlert","Не все поля  со звездочкой * заполнены"),!1;if(0===this.advertisingProgram.houseIdList.length)return this.$emit("showAlert","Не выбраны дома"),!1;const e=this.advertisingProgram.id>0?`${this.advertisingProgram.id}/`:"",i=this.advertisingProgram.id>0?"PUT":"POST",s=`${n.urls.advertisingProgram}${this.period}/${e}`;try{const e=this.advertisingProgram;e.period=this.period,e.isUpdatePosition=t;const a=await fetch(s,{method:i,body:JSON.stringify(e),headers:{"Content-Type":"application/json","X-CSRFToken":l.getCookie("csrftoken")}});a.status>201?this.$emit("showAlert",await a.text()):(this.$emit("showAlert","Данные сохранены"),this.closeDialog())}catch(a){this.$emit("showAlert","Ошибка при обращение к серверу")}},async getFormatList(){const t=`${n.urls.paperSize}`,e=await fetch(t,{method:"get"});this.paperSizeList=await e.json()},async getClientList(){const t=`${n.urls.clientAutocomplite}${this.period}/`,e=await fetch(t,{method:"get"});this.clientList=await e.json()},checkClientInPeriod:function(){if(this.advertisingProgram.client===this.advertisingProgram.oldClientId)return!1;const t=this.clientList.find((t=>t.id===this.advertisingProgram.client));return!!t},async getHomeList(t=!1){this.ajaxLoadHome=!0;const e=`${n.urls.freeSpaceElevator}${this.period}/?`+new URLSearchParams(this.filterAndSortHome)+`&client=${this.advertisingProgram.client}`,i=await fetch(e,{method:"get"}),s=await i.json();this.homeList=s,this.ajaxLoadHome=!1,t&&(this.allHouseList=s)},uncheckSelectHome:function(){for(const t of this.homeListFiltred)this.advertisingProgram.houseIdList=this.advertisingProgram.houseIdList.filter((e=>e!==t.id))},checkSelectHome:function(){for(const t of this.homeListFiltred)-1===this.advertisingProgram.houseIdList.indexOf(t.id)&&this.advertisingProgram.houseIdList.push(t.id)}},async created(){this.getFormatList()},watch:{"filterAndSortRp.clientType":function(){this.getAdvertisingProgramList()},"filterAndSortRp.paperSize":function(){this.getAdvertisingProgramList()},"filterAndSortRp.inArchive":function(){this.getAdvertisingProgramList()},"filterAndSortRp.isComplete":function(){this.getAdvertisingProgramList()},"filterAndSortRp.orderBy":function(){this.getAdvertisingProgramList()},"filterAndSortHome.orderBy":function(){this.getHomeList()},"filterAndSortHome.address":function(){this.getHomeList()},"filterAndSortHome.homeShowBusy":function(){this.getHomeList()},"filterAndSortHome.dontCurentClient":function(){this.getHomeList()}}},it=et,st=(0,h.Z)(it,Y,tt,!1,null,"13345c22",null),at=st.exports,rt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-card",{staticClass:"shadow pt-3 pb-4 px-3 ap-list-card h-100",attrs:{outlined:"",elevation:"7"}},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-9 pt-0 pb-3"},[i("v-list-item-subtitle",{},[i("b",[t._v(t._s(t.house.address)+" "),i("br"),t._v("(лифтов: "+t._s(t.house.elevatorCount)+" шт.) ")])])],1),i("div",{staticClass:"col-3 pt-0 pb-3 text-right"},[i("v-icon",{attrs:{color:"orange",dark:""},on:{click:function(e){return t.$emit("openChangePositionWindow",t.house.houseId)}}},[t._v("mdi-pencil-outline")])],1)]),i("hr",{staticClass:"my-2 mb-1"}),i("div",{staticClass:"row"},[i("div",{staticClass:"col-12 small py-1"},[i("div",{staticClass:"m-0"},[t._l(t.house.advertisingProgram,(function(e,s){return i("div",{key:s,staticClass:"my-1"},[i("b",{staticClass:"pointer-cursor",class:{"text-info":2===e.clientType,"text-success":3===e.clientType,"text-warning":4===e.clientType},on:{click:function(i){return t.showDialog(e.advertisingProgramId)}}},[e.position?i("span",[t._v(" "+t._s(e.position)),e.elevatorPosition?i("span",[t._v("(фикс)")]):t._e()]):i("b",{staticClass:"text-danger"},[t._v("БЕЗ МЕСТА")]),t._v(" . "+t._s(e.clientName)+" "+t._s(e.note)+" ")])])})),i("div",{staticClass:"mt-1"},[i("div",{staticClass:"mb-2"},[0===t.house.freeArea?i("v-chip",{attrs:{small:"",color:"success"}},[t._v(" Свободно площадок "+t._s(t.house.freeArea)+" из "+t._s(t.house.advertisingSpaceA4Count)+" ")]):t.house.freeArea<0?i("v-chip",{attrs:{small:"",color:"red",dark:""}},[t._v(" Свободно площадок "+t._s(t.house.freeArea)+" из "+t._s(t.house.advertisingSpaceA4Count)+" ")]):i("v-chip",{attrs:{small:"",color:"warning"}},[t._v(" Свободно площадок "+t._s(t.house.freeArea)+" из "+t._s(t.house.advertisingSpaceA4Count)+" ")])],1),i("div",{},[0===t.house.lackPhoto?i("v-chip",{attrs:{color:"success",small:""}},[t._v("Фотографий "+t._s(t.house.photoCount)+" из "+t._s(t.house.elevatorCount)+" ")]):t.house.lackPhoto>0?i("v-chip",{attrs:{color:"warning",small:""}},[t._v("Фотографий "+t._s(t.house.photoCount)+" из "+t._s(t.house.elevatorCount)+" ")]):i("v-chip",{attrs:{dark:"",color:"red",small:""}},[t._v("Фотографий "+t._s(t.house.photoCount)+" из "+t._s(t.house.elevatorCount)+" ")])],1),t.house.crossConflict||t.house.dontPosition?i("div",{staticClass:"mt-2"},[i("v-chip",{attrs:{dark:"",color:"red",small:""}},[t._v("Конфликт размещения ")])],1):t._e()])],2)])])])},ot=[],nt={name:"AppAdvertisingProgramListCard",props:["house"],methods:{showDialog(t=0){this.$emit("showDialog",t)}}},lt=nt,ct=(0,h.Z)(lt,rt,ot,!1,null,"0d5c224f",null),dt=ct.exports,vt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"position-relative",class:{wrap:t.dialogShow}},[i("v-dialog",{attrs:{value:t.dialogShow,persistent:"",scrollable:"","max-width":"1000px"}},[i("v-card",[i("v-card-title",{staticClass:"text-center bg-light "},[i("div",{staticClass:"h3 "},[t._v(t._s(t.changeData.address))]),i("div",{staticClass:"ms-auto"},[i("button",{staticClass:"close-btn",on:{click:t.closeDialog}},[i("v-icon",[t._v(" mdi-close-circle ")])],1)])]),i("v-card-text",[i("v-card",{staticClass:"py-3 ",attrs:{color:"basil",flat:""}},[i("v-progress-linear",{staticClass:"mt-3",attrs:{indeterminate:"",active:t.ajaxLoad,color:"yellow darken-2"}}),t.changeData.advertisingProgramHouseList.length>0?i("v-simple-table",{attrs:{light:"","fixed-header":"",height:"630px"},scopedSlots:t._u([{key:"default",fn:function(){return[i("thead",[i("tr",[i("th",{staticClass:"text-left"},[t._v(" Рекламная программа ")]),i("th",{staticClass:"text-left",attrs:{width:"100"}},[t._v(" Позиция ")]),i("th",{staticClass:"text-center",attrs:{width:"100"}})])]),i("tbody",t._l(t.changeData.advertisingProgramHouseList,(function(e){return i("tr",{key:e.id},[i("td",[i("v-autocomplete",{staticClass:"pointer-cursor",attrs:{"item-text":"name","item-value":"id",items:t.changeData.advertisingProgramList},model:{value:e.advertisingProgram,callback:function(i){t.$set(e,"advertisingProgram",i)},expression:"item.advertisingProgram"}})],1),i("td",[i("v-text-field",{attrs:{type:"number","aria-valuemax":"8"},model:{value:e.position,callback:function(i){t.$set(e,"position",i)},expression:"item.position"}})],1),i("td",[i("v-btn",{staticClass:"mr-3 ",attrs:{color:"orange",text:"",fab:""},on:{click:function(i){return t.deleteItem(e)}}},[i("v-icon",{attrs:{large:"",color:"orange darken-2"}},[t._v(" mdi-delete ")])],1)],1)])})),0)]},proxy:!0}],null,!1,1750087242)}):i("v-alert",{attrs:{dense:"",icon:"mdi-information-outline",text:"",color:"orange"}},[i("span",{staticClass:" mt-3 text-dark"},[t._v("хмммм... Как странно, но данных нет... А у дома точна есть реклама? -_-")])]),i("div",{staticClass:"row mt-3"},[i("div",{staticClass:"col-6"},[i("v-btn",{staticClass:"mr-4",attrs:{color:"orange",dark:""},on:{click:function(e){return t.addItem()}}},[i("v-icon",[t._v("mdi mdi-plus-circle-outline")]),t._v(" Добавить ")],1),i("v-btn",{attrs:{color:"orange",dark:""},on:{click:function(e){return t.autoNum()}}},[i("v-icon"),t._v(" Пронумеровать ")],1)],1),i("div",{staticClass:"col-6 text-right "},[i("v-btn",{attrs:{color:"orange",dark:""},on:{click:t.save}},[i("v-icon",[t._v("mdi mdi-content-save")]),t._v(" Сохранить ")],1)],1)])],1)],1)],1)],1)],1)},ut=[],ht={name:"AppAdvertisingProgramEditWindow",data(){return{ajaxLoad:!0,dialogShow:!1,changeData:{id:void 0,address:"",advertisingProgramHouseList:[],advertisingProgramList:[]},period:"",houseId:""}},computed:{elevatorPositionList:function(){const t=[{name:"Без места",id:null}];for(let e=1;e<=8;e++)t.push({name:e,id:e});return t}},methods:{closeDialog:function(){this.dialogShow=!1,this.changeData={id:void 0,address:"",advertisingProgramHouseList:[],advertisingProgramList:[]},this.$emit("closeDialog",{})},async geServerData(t,e){this.period=e,this.ajaxLoad=!0;const i=`${n.urls.advertisingProgramEdit}${e}/${t}/`,s=await fetch(i,{method:"get"});this.changeData=await s.json(),this.ajaxLoad=!1},async openDialog(t,e){await this.geServerData(t,e),this.dialogShow=!0,this.houseId=t},deleteItem(t){this.changeData.advertisingProgramHouseList=this.changeData.advertisingProgramHouseList.filter((e=>e!==t))},addItem(){this.changeData.advertisingProgramHouseList.push({position:null,advertisingProgram:""})},autoNum(){let t=1;this.changeData.advertisingProgramHouseList.forEach((e=>{e.position=t,t+=1}))},async save(){this.changeData.advertisingProgramHouseList=this.changeData.advertisingProgramHouseList.filter((t=>""!==t.advertisingProgram));const t=`${n.urls.advertisingProgramEdit}${this.period}/${this.houseId}/`;try{const e=await fetch(t,{method:"POST",body:JSON.stringify(this.changeData.advertisingProgramHouseList),headers:{"Content-Type":"application/json","X-CSRFToken":l.getCookie("csrftoken")}});e.status>201?this.$emit("showAlert",await e.text()):(this.$emit("showAlert","Данные сохранены"),this.closeDialog())}catch(e){this.$emit("showAlert","Ошибка при обращение к серверу")}}}},mt=ht,gt=(0,h.Z)(mt,vt,ut,!1,null,"720b628e",null),pt=gt.exports,ft=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"position-relative",class:{wrap:t.dialogShow}},[i("v-dialog",{attrs:{value:t.dialogShow,persistent:"",scrollable:"","max-width":"1200px"}},[i("v-card",[i("v-card-title",{staticClass:"text-center bg-light "},[i("div",{staticClass:"h3 "},[t._v("Продление рекламных программ")]),i("div",{staticClass:"ms-auto"},[i("button",{staticClass:"close-btn",on:{click:t.closeDialog}},[i("v-icon",[t._v(" mdi-close-circle ")])],1)])]),i("v-card-text",[i("v-card",{staticClass:"py-3 ",attrs:{color:"basil",flat:""}},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-12 pb-1"},[i("b",[t._v("Шаг 1. Выберите период в который продлеваем и статус переноса")])]),i("div",{staticClass:"col-4"},[i("v-select",{attrs:{label:"Выбранный период","item-text":"name",disabled:"","item-value":"slug",items:t.periodList},model:{value:t.periodBefore,callback:function(e){t.periodBefore=e},expression:"periodBefore"}})],1),i("div",{staticClass:"col-4"},[i("v-select",{attrs:{label:"Период в который продлеваем*","item-text":"name","item-value":"slug",items:t.periodAfterList},model:{value:t.periodAfter,callback:function(e){t.periodAfter=e},expression:"periodAfter"}})],1),i("div",{staticClass:"col-4"},[i("v-select",{attrs:{label:"Применить статус*","item-text":"label","item-value":"id",items:t.statusApList},model:{value:t.statusAp,callback:function(e){t.statusAp=e},expression:"statusAp"}})],1)]),t.periodAfter?i("hr"):t._e(),i("v-progress-linear",{staticClass:"mt-3",attrs:{indeterminate:"",active:t.ajaxLoad,color:"yellow darken-2"}}),t.periodAfter?i("div",{staticClass:"row"},[i("div",{staticClass:"col-12"},[i("b",[t._v("Шаг 2. Выберите программы для переноса")])]),i("div",{staticClass:"col-4 pb-0"},[i("v-text-field",{attrs:{label:"Наименование"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getServerData.apply(null,arguments)},blur:t.getServerData},model:{value:t.filterAndSort.name,callback:function(e){t.$set(t.filterAndSort,"name",e)},expression:"filterAndSort.name"}})],1),i("div",{staticClass:"col-4 pb-0"},[i("v-select",{attrs:{label:"Тип","item-text":"label","item-value":"id",items:t.clientTypeList},model:{value:t.filterAndSort.clientType,callback:function(e){t.$set(t.filterAndSort,"clientType",e)},expression:"filterAndSort.clientType"}})],1),i("div",{staticClass:"col-4 pb-0"},[i("v-select",{attrs:{label:"Статус","item-text":"label","item-value":"id",items:t.statusAdvertisingProgramList},model:{value:t.filterAndSort.statusAdvertisingProgram,callback:function(e){t.$set(t.filterAndSort,"statusAdvertisingProgram",e)},expression:"filterAndSort.statusAdvertisingProgram"}})],1),i("div",{staticClass:"col-12"},[i("v-simple-table",{attrs:{light:"","fixed-header":"",height:"350px"},scopedSlots:t._u([{key:"default",fn:function(){return[i("thead",[i("tr",[i("th",{staticClass:"text-left"},[t._v(" Рекламная программа ")]),i("th",{staticClass:"text-left"},[t._v(" Тип ")]),i("th",{staticClass:"text-left"},[t._v(" Статус ")]),i("th",{staticClass:"text-left",attrs:{width:"100"}},[t._v(" Переносить? ")])])]),i("tbody",t._l(t.advertisingProgramHouseList,(function(e){return i("tr",{key:e.id,class:{"text-info":2===e.clientType,"text-success":3===e.clientType,"text-warning":4===e.clientType}},[i("td",[t._v(" "+t._s(e.advertisingProgramDisplay)+" ")]),i("td",[t._v(" "+t._s(e.typeDisplay)+" ")]),i("td",[t._v(" "+t._s(e.statusDisplay)+" ")]),i("td",[i("v-switch",{staticClass:"m-0 p-0",attrs:{color:"orange","hide-details":"",value:e.id},model:{value:t.saveData,callback:function(e){t.saveData=e},expression:"saveData"}})],1)])})),0)]},proxy:!0}],null,!1,1574645502)})],1)]):t._e(),t.periodAfter?i("div",{staticClass:"row"},[i("div",{staticClass:"col-6"},[i("v-btn",{staticClass:"mr-3",attrs:{color:"orange",dark:"",outlined:"",text:""},on:{click:function(e){return t.checkSelect()}}},[i("v-icon",[t._v("mdi-checkbox-marked-outline")]),t._v(" Отметить выбранные ")],1),i("v-btn",{attrs:{color:"orange",dark:"",outlined:"",text:""},on:{click:function(e){return t.uncheckSelect()}}},[i("v-icon",[t._v("mdi-checkbox-blank-outline")]),t._v(" Снять выбранные ")],1)],1)]):t._e(),t.periodAfter?i("hr"):t._e(),t.periodAfter?i("div",{staticClass:"row"},[i("div",{staticClass:"col-10"},[i("v-alert",{attrs:{dense:"",icon:"mdi-information-outline",text:"",color:"orange"}},[i("span",{staticClass:" mt-3 text-dark"},[t._v("Внимание. Если в период в который Вы продлеваете уже была выбранная РП. "),i("br"),t._v("То программа создаст ещё одну копию")])])],1),i("div",{staticClass:"col-2 text-right"},[t.ajaxLoad?t._e():i("v-btn",{attrs:{color:"orange",dark:""},on:{click:t.save}},[i("v-icon",[t._v("mdi mdi-content-save")]),t._v(" Продлить ")],1)],1)]):t._e()],1)],1)],1)],1)],1)},bt=[],Ct={name:"AppAdvertisingProgramProlongWindow",data(){return{ajaxLoad:!1,dialogShow:!1,periodList:[],statusApList:n.statusAdvertisingProgramList,statusAp:"",periodBefore:"",periodAfter:"",filterAndSort:{clientType:"",statusAdvertisingProgram:"",name:""},clientTypeList:[{id:"",label:"-"},...n.clientTypeList],statusAdvertisingProgramList:[{id:"",label:"-"},...n.statusAdvertisingProgramList],saveData:[],advertisingProgramHouseList:[]}},computed:{periodAfterList:function(){return this.periodList.filter((t=>t.slug!==this.periodBefore))},advertisingProgramHouseListLocal:function(){return this.advertisingProgramHouseList}},methods:{closeDialog:function(){this.dialogShow=!1,this.saveData=[],this.filterAndSort={clientType:"",statusAdvertisingProgram:"",name:""},this.$emit("closeDialog",{})},async getPeriodList(){const t=`${n.urls.period}`,e=await fetch(t,{method:"get"}),i=await e.json();this.periodList=i.periodList},async getServerData(t){if(this.periodBefore&&this.periodAfter){this.ajaxLoad=!0;const e=`${n.urls.advertisingProgramProlong}${this.periodBefore}/${this.periodAfter}/?`+new URLSearchParams(this.filterAndSort),i=await fetch(e,{method:"get"});this.ajaxLoad=!1;const s=await i.json();this.advertisingProgramHouseList=s.advertisingProgramHouseList,t.inFirst&&(this.saveData=s.prolongList)}},async openDialog(t){this.periodBefore=t,this.getServerData({inFirst:!0}),this.getPeriodList(),this.dialogShow=!0},uncheckSelect:function(){for(const t of this.advertisingProgramHouseListLocal)this.saveData=this.saveData.filter((e=>e!==t.id))},checkSelect:function(){for(const t of this.advertisingProgramHouseListLocal)-1===this.saveData.indexOf(t.id)&&this.saveData.push(t.id)},async save(){if(!this.periodAfter)return this.$emit("showAlert","Вы не выбрали не период на шаге 1"),!1;if(!this.statusAp)return this.$emit("showAlert","Вы не выбрали статус на шаге 1"),!1;if(0===this.saveData.length)return this.$emit("showAlert","Вы не выбрали не одну РП на шаге 2"),!1;this.ajaxLoad=!0;const t=`${n.urls.advertisingProgramProlong}${this.periodBefore}/${this.periodAfter}/`;try{const e=await fetch(t,{method:"POST",body:JSON.stringify({saveData:this.saveData,statusAp:this.statusAp}),headers:{"Content-Type":"application/json","X-CSRFToken":l.getCookie("csrftoken")}});this.ajaxLoad=!1,e.status>201?this.$emit("showAlert",await e.text()):(this.$emit("showAlert","Данные сохранены"),this.closeDialog())}catch(e){this.$emit("showAlert","Ошибка при обращение к серверу")}}},watch:{"filterAndSort.clientType"(){this.getServerData()},"filterAndSort.statusAdvertisingProgram"(){this.getServerData()},periodAfter(){this.getServerData({inFirst:!0})}}},_t=Ct,xt=(0,h.Z)(_t,ft,bt,!1,null,"81b792ea",null),At=xt.exports,yt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"position-relative",class:{wrap:t.dialogShow}},[i("v-dialog",{attrs:{value:t.dialogShow,persistent:"",scrollable:"","max-width":"1200px"}},[i("v-card",[i("v-card-title",{staticClass:"text-center bg-light "},[i("div",{staticClass:"h3 "},[t._v("Объединение рекламных программ")]),i("div",{staticClass:"ms-auto"},[i("button",{staticClass:"close-btn",on:{click:t.closeDialog}},[i("v-icon",[t._v(" mdi-close-circle ")])],1)])]),i("v-card-text",[i("v-card",{staticClass:"py-3 ",attrs:{color:"basil",flat:""}},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-12 pb-1"},[i("b",[t._v("Шаг 1. Выберите рекламные программы для объединения ")])]),i("div",{staticClass:"col-4"},[i("v-select",{attrs:{label:"Период","item-text":"name",disabled:"","item-value":"slug",items:t.periodList},model:{value:t.period,callback:function(e){t.period=e},expression:"period"}})],1),i("div",{staticClass:"col-4"},[i("v-autocomplete",{attrs:{label:"РП с которой объединяем(первая РП)*","item-text":"name","item-value":"id",items:t.advertisingProgramFirstList},on:{change:function(e){return t.getAdvertisingProgramSecondList()}},model:{value:t.advertisingProgramFirst,callback:function(e){t.advertisingProgramFirst=e},expression:"advertisingProgramFirst"}})],1),i("div",{staticClass:"col-4"},[i("v-autocomplete",{attrs:{label:"РП которую объединяем(вторая РП)*","item-text":"name","item-value":"id","no-data-text":"Не найдено с чем объединить",items:t.advertisingProgramSecondList},on:{change:function(e){return t.getAdvertisingProgramHouseList()}},model:{value:t.advertisingProgramSecond,callback:function(e){t.advertisingProgramSecond=e},expression:"advertisingProgramSecond"}})],1)]),t.advertisingProgramSecond?i("hr"):t._e(),i("v-progress-linear",{staticClass:"mt-3",attrs:{indeterminate:"",active:t.ajaxLoad,color:"yellow darken-2"}}),t.advertisingProgramSecond?i("div",{staticClass:"row"},[i("div",{staticClass:"col-12"},[i("b",[t._v("Шаг 2. Проверьте список домов которые попадут из второй РП в первую")])]),i("div",{staticClass:"col-12"},[i("v-simple-table",{attrs:{light:"","fixed-header":"",height:"350px"},scopedSlots:t._u([{key:"default",fn:function(){return[i("thead",[i("tr",[i("th",{staticClass:"text-left"},[t._v(" Адрес ")]),i("th",{staticClass:"text-left"},[t._v(" Статус был ")]),i("th",{staticClass:"text-left"},[t._v(" Статус станет ")])])]),i("tbody",t._l(t.advertisingProgramHouseList,(function(e){return i("tr",{key:e.id},[i("td",[t._v(" "+t._s(e)+" ")]),i("td",[t._v(" "+t._s(t.secondStatus)+" ")]),i("td",[t._v(" "+t._s(t.firstStatus)+" ")])])})),0)]},proxy:!0}],null,!1,3654290823)})],1)]):t._e(),t.advertisingProgramSecond?i("hr"):t._e(),t.advertisingProgramSecond?i("div",{staticClass:"row"},[i("div",{staticClass:"col-10"},[i("v-alert",{attrs:{dense:"",icon:"mdi-information-outline",text:"",color:"orange"}},[i("span",{staticClass:" mt-3 text-dark"},[t._v("Внимание. После объединения РП которую объединяем будет отправлена в архив")])])],1),i("div",{staticClass:"col-2 text-right"},[t.ajaxLoad?t._e():i("v-btn",{attrs:{color:"orange",dark:""},on:{click:function(e){return t.merge()}}},[i("v-icon",[t._v("mdi-source-merge")]),t._v(" Объединить ")],1)],1)]):t._e()],1)],1)],1)],1)],1)},wt=[],St={name:"AppAdvertisingProgramMergeWindow",data(){return{ajaxLoad:!1,dialogShow:!1,periodList:[],advertisingProgramFirst:"",advertisingProgramSecond:null,period:"",advertisingProgramHouseList:null,advertisingProgramFirstList:[],advertisingProgramSecondList:null,firstStatus:"-",secondStatus:"-"}},methods:{closeDialog:function(){this.dialogShow=!1,this.advertisingProgramFirst="",this.advertisingProgramSecond=null,this.advertisingProgramHouseList=null,this.firstStatus="-",this.secondStatus="-",this.$emit("closeDialog",{})},async getPeriodList(){const t=`${n.urls.period}`,e=await fetch(t,{method:"get"}),i=await e.json();this.periodList=i.periodList},async getAdvertisingProgramFirstList(){this.ajaxLoad=!0;const t=`${n.urls.advertisingProgramMergeGetFirst}${this.period}/`,e=await fetch(t,{method:"get"});this.advertisingProgramFirstList=await e.json(),this.ajaxLoad=!1},async getAdvertisingProgramSecondList(){this.ajaxLoad=!0,this.advertisingProgramSecondList=null,this.advertisingProgramHouseList=null,this.advertisingProgramSecond=null,this.firstStatus="-",this.secondStatus="-";const t=`${n.urls.advertisingProgramMergeGetSecond}${this.period}/${this.advertisingProgramFirst}/`,e=await fetch(t,{method:"get"});this.advertisingProgramSecondList=await e.json(),this.ajaxLoad=!1},async getAdvertisingProgramHouseList(){if(this.advertisingProgramSecond){this.ajaxLoad=!0,this.firstStatus="-",this.secondStatus="-",this.advertisingProgramHouseList=null;const t=`${n.urls.advertisingProgramMergeGetHouseList}${this.period}/${this.advertisingProgramFirst}/${this.advertisingProgramSecond}/`,e=await fetch(t,{method:"get"}),i=await e.json();this.advertisingProgramHouseList=i.houseList,this.firstStatus=i.firstStatus,this.secondStatus=i.secondStatus,this.ajaxLoad=!1}},async merge(){if(this.advertisingProgramSecond){this.ajaxLoad=!0;const t=`${n.urls.advertisingProgramMerge}${this.period}/${this.advertisingProgramFirst}/${this.advertisingProgramSecond}/`,e=await fetch(t,{method:"get"}),i=await e.json();this.$emit("showAlert",i.status),"Объединение прошло успешно"===i.status&&this.closeDialog(),this.ajaxLoad=!1}},async openDialog(t){this.period=t,this.getPeriodList(),this.getAdvertisingProgramFirstList(),this.dialogShow=!0},async save(){if(!this.periodAfter)return this.$emit("showAlert","Вы не выбрали не период на шаге 1"),!1;if(!this.advertisingProgramFirst)return this.$emit("showAlert","Вы не выбрали РП с которой будет объединение"),!1;if(!this.advertisingProgramFirst)return this.$emit("showAlert","Вы не выбрали РП которую будем объединять"),!1;this.ajaxLoad=!0;const t=`${n.urls.advertisingProgramMerge}${this.period}/`;try{const e=await fetch(t,{method:"POST",body:JSON.stringify({}),headers:{"Content-Type":"application/json","X-CSRFToken":l.getCookie("csrftoken")}});this.ajaxLoad=!1,e.status>201?this.$emit("showAlert",await e.text()):(this.$emit("showAlert","Данные сохранены"),this.closeDialog())}catch(e){this.$emit("showAlert","Ошибка при обращение к серверу")}}}},kt=St,Lt=(0,h.Z)(kt,yt,wt,!1,null,"50d62837",null),Pt=Lt.exports,$t={name:"AdvertisingProgramView",components:{AppAdvertisingProgramEditWindow:pt,AppAdvertisingProgramWindow:at,AppAdvertisingProgramProlongWindow:At,AppAdvertisingProgramMergeWindow:Pt,AppAdvertisingProgramListCard:dt},data(){return{isLoad:!0,ajaxLoad:!1,showStatistic:!1,periodList:[],advertisingProgramList:[],statistic:{},countHouseAll:0,countHouseAfterFilter:0,countElevatorAfterFilter:0,countElevatorAll:0,pageCount:1,isListView:!0,orderByList:[{id:"address",label:"Наименования от А до Я"},{id:"-address",label:"Наименования от Я до А"},{id:"-order_index",label:"Согласно КП"}],bysyAndConflictList:[{id:"",label:"-"},{id:"allBysy",label:"Всё занято"},{id:"hasFree",label:"Есть свободные"},{id:"hasFreeOrKenguru",label:"Есть свободные или Кенгуру"},{id:"overflow",label:"Занято больше, чем мест в лифте"},{id:"dontPosition",label:"Конфликт. Нет позиции"},{id:"crossConflict",label:"Конфликт. Пересечение позиций"}],hasPhotoList:[{id:"",label:"-"},{id:"enough",label:"Хватает"},{id:"lack",label:"Не хватает"},{id:"overflow",label:"Больше чем надо"}],filterAndSort:{orderBy:"-order_index",page:1,bysyAndConflict:"",searchAddress:"",hasPhoto:"",searchClient:"",period:"",clientType:"",statusAdvertisingProgram:""}}},computed:{linkRenderAdhesiveSheet:function(){return`${n.urls.renderAdhesiveSheet}${this.filterAndSort.period}`}},methods:{async getPeriodList(){const t=`${n.urls.period}`,e=await fetch(t,{method:"get"}),i=await e.json();this.periodList=i.periodList,this.filterAndSort.period=i.periodNow},openChangePositionWindow(t){this.$refs.apChangePositionWindow.openDialog(t,this.filterAndSort.period)},openApProlongWindow(t){this.$refs.apProlongWindow.openDialog(t,this.filterAndSort.period)},openMergeWindow(t){this.$refs.advertisingProgramMergeWindow.openDialog(t,this.filterAndSort.period)},showDialog(t=null){this.$refs.apWindow.openDialog(t)},setFilterClientType(t){this.filterAndSort.statusAdvertisingProgram="",this.filterAndSort.clientType===t?this.filterAndSort.clientType="":this.filterAndSort.clientType=t},setFilterStatusAdvertisingProgram(t){this.filterAndSort.clientType="",this.filterAndSort.statusAdvertisingProgram===t?this.filterAndSort.statusAdvertisingProgram="":this.filterAndSort.statusAdvertisingProgram=t},resetFilterAndSort(){this.filterAndSort={orderBy:"-order_index",page:1,searchAddress:"",bysyAndConflict:"",hasPhoto:"",searchClient:"",clientType:"",statusAdvertisingProgram:"",period:this.filterAndSort.period},this.getList()},closeDialog(){this.getList(),this.getStatstic()},async getStatstic(){const t=`${n.urls.advertisingProgramStatistic}${this.filterAndSort.period}/`,e=await fetch(t,{method:"get"});this.statistic=await e.json()},async getList(){this.ajaxLoad=!0;const t=`${n.urls.advertisingAndDetail}${this.filterAndSort.period}/?`+new URLSearchParams(this.filterAndSort),e=await fetch(t,{method:"get"}),i=await e.json();this.advertisingProgramList=i["data"],this.countHouseAll=i["countHouseAll"],this.countHouseAfterFilter=i["countHouseAfterFilter"],this.countElevatorAfterFilter=i["countElevatorAfterFilter"],this.countElevatorAll=i["countElevatorAll"],this.pageCount=i["pageCount"],this.ajaxLoad=!1,this.$emit("loadComplete")}},async created(){await this.getPeriodList()},watch:{"filterAndSort.orderBy"(){this.filterAndSort.page=1,this.getList()},"filterAndSort.clientType"(){this.filterAndSort.page=1,this.getList()},"filterAndSort.statusAdvertisingProgram"(){this.filterAndSort.page=1,this.getList()},"filterAndSort.hasPhoto"(){this.filterAndSort.page=1,this.getList()},"filterAndSort.bysyAndConflict"(){this.filterAndSort.page=1,this.getList()},"filterAndSort.searchClient"(){this.filterAndSort.page=1,this.getList()},"filterAndSort.period"(){this.filterAndSort.page=1,this.getList(),this.getStatstic()},"filterAndSort.page"(){this.getList()}}},Dt=$t,Tt=(0,h.Z)(Dt,q,Q,!1,null,"393b3f86",null),jt=Tt.exports,Ht=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"w-100 px-3 pt-2  d-flex flex-column mb-5"},[i("h1",[t._v("Свободные площадки")]),i("div",{staticClass:"row"},[i("div",{staticClass:"col-12 col-md-5 py-0 py-md-3 my-0 my-md-0"},[i("v-select",{attrs:{label:"Сортировка по:","item-text":"label","item-value":"id",items:t.orderByList},model:{value:t.filterAndSort.orderBy,callback:function(e){t.$set(t.filterAndSort,"orderBy",e)},expression:"filterAndSort.orderBy"}})],1),i("div",{staticClass:"col-12 col-md-5 py-0 py-md-3 my-0 my-md-0"},[i("v-select",{attrs:{label:"Период","item-text":"name","item-value":"slug",items:t.periodList},model:{value:t.filterAndSort.period,callback:function(e){t.$set(t.filterAndSort,"period",e)},expression:"filterAndSort.period"}})],1),i("div",{staticClass:"col-12 col-md-2 py-0 py-md-3 mt-0 mb-3 my-md-0 text-md-center text-left"},[i("v-btn",{attrs:{color:"orange",dark:"",href:t.linkReportFreeElevators,target:"_blank"}},[i("v-icon",[t._v("mdi-file-excel")]),i("b",[t._v("Скачать в Excel ")])],1)],1)]),i("div",{staticClass:"mb-0 pb-0 col-12"},[i("span",{staticClass:"small"},[t._v("Отображается: "+t._s(t.countHouseServer)+" домов | "+t._s(t.countElevatorServer)+" лифтов ")])]),i("v-progress-linear",{staticClass:"mt-3",attrs:{indeterminate:"",active:t.ajaxLoad,color:"yellow darken-2"}}),[t.houseList.length>0?i("v-simple-table",{attrs:{"fixed-header":"",height:"700px"},scopedSlots:t._u([{key:"default",fn:function(){return[i("thead",[i("tr",[i("th",{staticClass:"text-left"},[t._v(" Адрес ")]),i("th",{staticClass:"text-center"},[t._v(" Лифтов в доме ")]),i("th",{staticClass:"text-center"},[t._v(" Свободных площадок в лифте ")])])]),i("tbody",{staticClass:"small"},t._l(t.houseList,(function(e){return i("tr",{key:e.address},[i("td",[t._v(t._s(e.address))]),i("td",{staticClass:"text-center"},[t._v(t._s(e.elevatorCount))]),i("td",{staticClass:"text-center"},[t._v(t._s(e.countFreeArea))])])})),0)]},proxy:!0}],null,!1,1469478028)}):i("v-alert",{attrs:{dense:"",icon:"mdi-information-outline",text:"",color:"orange"}},[i("span",[t._v("Свободных площадок в данном периоде нет. Посмотрите пожалуйста следующий")])])]],2)},Ft=[],Rt={name:"FreeElevatorsView",components:{},data(){return{houseList:[],countHouseServer:0,countElevatorServer:0,ajaxLoad:!1,filterAndSort:{period:"",orderBy:"-order_index"},periodList:[],orderByList:[{id:"address",label:"Наименования от А до Я"},{id:"-address",label:"Наименования от Я до А"},{id:"-order_index",label:"Согласно КП"}]}},computed:{linkReportFreeElevators:function(){return`${n.urls.renderReportFreeArea}${this.filterAndSort.period}`}},methods:{async getList(){this.ajaxLoad=!0;const t=`${n.urls.reportFreeElevators}?`+new URLSearchParams(this.filterAndSort),e=await fetch(t,{method:"get"}),i=await e.json();this.houseList=i.data,this.countHouseServer=i["countHouse"],this.countElevatorServer=i["elevatorCount"],this.ajaxLoad=!1},async getPeriodList(){const t=`${n.urls.period}`,e=await fetch(t,{method:"get"}),i=await e.json();this.periodList=i.periodList,this.filterAndSort.period=i.periodNow}},async created(){await this.getPeriodList(),this.$emit("loadComplete")},watch:{"filterAndSort.orderBy"(){this.getList()},"filterAndSort.period"(){this.getList()}}},Bt=Rt,Et=(0,h.Z)(Bt,Ht,Ft,!1,null,"7bbbaf9e",null),Nt=Et.exports,It=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"w-100 h-100 px-3 pt-2 pb-5  d-flex flex-column  bg--warning align-self-center justify-center"},[i("div",{staticClass:"row "},[i("div",{staticClass:"col-12 col-sm-8 col-md-6 col-lg-5 col-xl-3 m-auto"},[i("div",{staticClass:"card shadow-lg p-3 text-center"},[t._m(0),t._m(1),i("form",{staticClass:"card-body forma-vhoda text-center",attrs:{method:"post",action:"#"}},[i("div",{staticClass:"mb-3"},[i("v-text-field",{attrs:{name:"login",label:"Логин"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.login.apply(null,arguments)}},model:{value:t.userForm.login,callback:function(e){t.$set(t.userForm,"login",e)},expression:"userForm.login"}})],1),i("div",{staticClass:"mb-3"},[i("v-text-field",{attrs:{name:"pas",type:"password",label:"Пароль"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.login.apply(null,arguments)}},model:{value:t.userForm.pas,callback:function(e){t.$set(t.userForm,"pas",e)},expression:"userForm.pas"}})],1),i("v-btn",{staticClass:"px-5",attrs:{color:"warning",dark:""},on:{click:t.login}},[t._v("Войти ")])],1)])])])])},Ot=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"text-center"},[s("img",{staticClass:"logo mb-3",attrs:{src:i(1637),alt:""}})])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("h3",[i("b",[t._v("КЕНГУРУ CRM")])])}],Wt={name:"LoginView",components:{},data(){return{userForm:{login:"",pas:""}}},methods:{async login(){try{const t=n.urls.login,e=await fetch(t,{method:"POST",body:JSON.stringify(this.userForm),headers:{"Content-Type":"application/json","X-CSRFToken":l.getCookie("csrftoken")}});if(200===e.status){const t=await e.json();l.setCookie("sessionid",t.sessionid,{"max-age":31536e3}),window.location.href="/"}else this.$emit("showAlert","Ошибка авторизации")}catch(t){this.$emit("showAlert","Ошибка при обращение к серверу")}}},async created(){this.$emit("loadComplete")}},zt=Wt,Ut=(0,h.Z)(zt,It,Ot,!1,null,"7ad2de04",null),Mt=Ut.exports;s["default"].use(k.Z);const Zt=[{path:"/",name:"freeElevatorsView",component:Nt},{path:"/client",name:"client",component:N},{path:"/house",name:"house",component:K},{path:"/advertising_program",name:"advertising_program",component:jt},{path:"/login",name:"login",component:Mt},{path:"*",name:"page404",component:Nt}],Xt=new k.Z({routes:Zt});var Vt=Xt,Jt=i(3822);s["default"].use(Jt.ZP);var Gt=new Jt.ZP.Store({state:{},getters:{},mutations:{},actions:{},modules:{}}),Kt=i(707),qt=i.n(Kt);i(8556);s["default"].use(qt());const Qt={};var Yt=new(qt())(Qt),te=(i(8937),i(8510)),ee=i.n(te);s["default"].config.productionTip=!1,new s["default"]({router:Vt,store:Gt,VueCookie:ee(),vuetify:Yt,render:t=>t(S)}).$mount("#app")},1637:function(t,e,i){t.exports=i.p+"static/front_prod/img/logo2.9ece864f.png"}},e={};function i(s){var a=e[s];if(void 0!==a)return a.exports;var r=e[s]={exports:{}};return t[s].call(r.exports,r,r.exports,i),r.exports}i.m=t,function(){var t=[];i.O=function(e,s,a,r){if(!s){var o=1/0;for(d=0;d<t.length;d++){s=t[d][0],a=t[d][1],r=t[d][2];for(var n=!0,l=0;l<s.length;l++)(!1&r||o>=r)&&Object.keys(i.O).every((function(t){return i.O[t](s[l])}))?s.splice(l--,1):(n=!1,r<o&&(o=r));if(n){t.splice(d--,1);var c=a();void 0!==c&&(e=c)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[s,a,r]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){i.p="/"}(),function(){var t={143:0};i.O.j=function(e){return 0===t[e]};var e=function(e,s){var a,r,o=s[0],n=s[1],l=s[2],c=0;if(o.some((function(e){return 0!==t[e]}))){for(a in n)i.o(n,a)&&(i.m[a]=n[a]);if(l)var d=l(i)}for(e&&e(s);c<o.length;c++)r=o[c],i.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return i.O(d)},s=self["webpackChunkfront"]=self["webpackChunkfront"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=i.O(void 0,[998],(function(){return i(1121)}));s=i.O(s)})();
//# sourceMappingURL=app.4e8877c7.js.map